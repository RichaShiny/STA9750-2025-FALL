<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Richa Shiny Tigiripally">
<meta name="dcterms.date" content="2025-11-02">

<title>MINI-PROJECT #02 - Making Backyards Affordable for All – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-cd7454b418030687c631a6a7286fbe16.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f59cc608e70ce16b384b3e6fc30ca698.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MINI-PROJECT #02 - Making Backyards Affordable for All</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Richa Shiny Tigiripally </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="images/FINAL-ALT-affordable-housing-cp-videoSixteenByNine3000-v2.jpg" class="img-fluid"></p>
<section id="executive-summary" class="level1">
<h1>EXECUTIVE SUMMARY</h1>
<p>I took the national housing data, blended it with employment and income stats, and asked one bold question: Do cities that build more housing actually make rent suck less? Spoiler: yes.</p>
<p>By creating two indices: Rent Burden (how painful rent feels) and Housing Growth (how much a city is actually building), we discovered a simple truth:</p>
<p>Cities that build → rent goes down</p>
<p>Cities that don’t → rent goes up</p>
<p>I crowned one metro a YIMBY champion (building enough homes) and called out one NIMBY troublemaker (talking about growth but not actually permitting anything). Then we identified two occupations that benefit most from more housing, because teachers and nurses shouldn’t have to choose between paying rent and buying groceries.</p>
<p>In short: housing math is not mysterious. Build more. Panic less.</p>
</section>
<section id="data-acquisition" class="level1">
<h1>DATA ACQUISITION</h1>
</section>
<section id="task-1-data-import" class="level1">
<h1>TASK 1: DATA IMPORT</h1>
<p>We’ll use the tidycensus package to pull ACS data, so instead of wrestling with raw Census files, R does the heavy lifting for us.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">## to documentation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Housing permits aren’t available in tidycensus, so we’ll download and prep that dataset manually.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> yy)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(...){</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                             <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>We’ll analyze data at the CBSA (metro area) level and use BLS NAICS codes to match housing trends with local industries and incomes.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rvest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    guess_encoding</code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(dplyr)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(tidyr)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(readr)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_perform</span>()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># These were looked up manually on bls.gov after finding </span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># they were presented as ranges. Since there are only three</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># it was easier to manually handle than to special-case everything else</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        naics_missing <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span>Code, <span class="sc">~</span>title, <span class="sc">~</span>depth, </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"31"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"32"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"33"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">"44"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>, </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">"45"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">"48"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span>, </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">"49"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(naics_table, naics_missing)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>                   level1_code,  level2_code,  level3_code,  level4_code) <span class="sc">|&gt;</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>            <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"code"</span>), as.integer))</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The BLS Quarterly Census of Employment and Wages</p>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(area_fips, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                       industry_code, </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                       annual_avg_emplvl, </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                       total_annual_wages, </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                       YEAR) <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                       <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>industry_code, </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>             <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    ALL_DATA</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="data-integration-and-initial-exploration" class="level1">
<h1>DATA INTEGRATION AND INITIAL EXPLORATION</h1>
</section>
<section id="task-2-multi-table-questions" class="level1">
<h1>Task 2: Multi-Table Questions</h1>
<section id="q1.-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" class="level3">
<h3 class="anchored" data-anchor-id="q1.-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive">Q1. Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scales'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    discard</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>TopPermits <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_permits =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_permits)) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(INCOME <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(GEOID, NAME), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the exact number (no scaling) nicely formatted</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>TopPermits <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_permits_fmt =</span> <span class="fu">comma</span>(total_permits))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
   CBSA total_permits NAME                                     total_permits_fmt
  &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;                                    &lt;chr&gt;            
1 26420        482075 Houston-Sugar Land-Baytown, TX Metro Ar… 482,075          
2 26420        482075 Houston-The Woodlands-Sugar Land, TX Me… 482,075          
3 26420        482075 Houston-Pasadena-The Woodlands, TX Metr… 482,075          </code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion:</h3>
<p>The output identifies the CBSA that issued the highest total number of new housing permits across the full decade. By aggregating permits year-by-year and ranking metros from highest to lowest, this reveals the metro area that experienced the most sustained level of residential construction activity over the 10-year period rather than a one-year spike.</p>
</section>
<section id="q2-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" class="level3">
<h3 class="anchored" data-anchor-id="q2-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units">Q2: In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>albuquerque_peak_year <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">10740</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">desc</span>(new_housing_units_permitted)) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(new_housing_units_permitted, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(year, new_housing_units_permitted)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>albuquerque_peak_year</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
   year new_housing_units_permitted
  &lt;dbl&gt;                       &lt;dbl&gt;
1  2021                        4021</code></pre>
</div>
</div>
</section>
<section id="conclusion-1" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-1">Conclusion:</h3>
<p>Albuquerque’s permitting activity fluctuates significantly from year to year. The output highlights the single year, 2021 with the highest number of new housing permits: 4021, capturing the true peak of construction activity in the dataset.</p>
</section>
<section id="q3-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015-to-answer-this-question-you-will-need-to-first-compute-the-total-income-per-cbsa-by-multiplying-the-average-household-income-by-the-number-of-households-and-then-sum-total-income-and-total-population-across-all-cbsas-in-a-state.-with-these-numbers-you-can-answer-this-question." class="level3">
<h3 class="anchored" data-anchor-id="q3-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015-to-answer-this-question-you-will-need-to-first-compute-the-total-income-per-cbsa-by-multiplying-the-average-household-income-by-the-number-of-households-and-then-sum-total-income-and-total-population-across-all-cbsas-in-a-state.-with-these-numbers-you-can-answer-this-question.">Q3: Which state (not CBSA) had the highest average individual income in 2015? To answer this question, you will need to first compute the total income per CBSA by multiplying the average household income by the number of households, and then sum total income and total population across all CBSAs in a state. With these numbers, you can answer this question.</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>income_state <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(POPULATION <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">total_income =</span> household_income <span class="sc">*</span> households,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="at">state_income =</span> <span class="fu">sum</span>(total_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="at">state_pop =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="at">avg_individual_income =</span> state_income <span class="sc">/</span> state_pop,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(avg_individual_income, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>income_state</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  state state_income state_pop avg_individual_income
  &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;                 &lt;dbl&gt;
1 DC    202663489140   6098283                33233.</code></pre>
</div>
</div>
</section>
<section id="conclusion-2" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-2">Conclusion:</h3>
<p>In 2015, the state with the highest average individual income was the District of Columbia. After aggregating all CBSAs within each state and computing total income (average household income × number of households) and total population, DC had approximately $202.7 billion in total income across 6,098,283 residents, resulting in an average individual income of about $33,233 per person. Although DC is not a state, the U.S. Census Bureau treats it as a state-equivalent for statistical reporting, and it ranks #1 nationally under that classification.</p>
</section>
<section id="q4-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country-in-recent-the-san-francisco-cbsa-has-had-the-most-data-scientists." class="level3">
<h3 class="anchored" data-anchor-id="q4-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country-in-recent-the-san-francisco-cbsa-has-had-the-most-data-scientists.">Q4: Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country? In recent, the San Francisco CBSA has had the most data scientists.</h3>
</section>
<section id="for-this-question-you-may-simply-create-a-table-of-which-cbsa-had-the-most-data-scientists-each-year-and-then-answer-the-question-in-the-following-text." class="level3">
<h3 class="anchored" data-anchor-id="for-this-question-you-may-simply-create-a-table-of-which-cbsa-had-the-most-data-scientists-each-year-and-then-answer-the-question-in-the-following-text.">For this question, you may simply create a table of which CBSA had the most data scientists each year and then answer the question in the following text.</h3>
</section>
<section id="note-that-the-census-bureau-and-the-bls-use-different-conventions-when-recording-cbsa-identification-numbers.-to-join-these-tables-together-you-will-need-to-create-a-new-column-to-join-on.-in-particular-the-bls-will-record-a-code-a-c1234-corresponding-to-a-census-identifier-of-12340-for-the-same-region.-to-match-these-up-it-is-easiest-to-create-a-new-column-in-the-bls-tables-which-transforms-values-like-c1234-into-12340-formatted-values." class="level3">
<h3 class="anchored" data-anchor-id="note-that-the-census-bureau-and-the-bls-use-different-conventions-when-recording-cbsa-identification-numbers.-to-join-these-tables-together-you-will-need-to-create-a-new-column-to-join-on.-in-particular-the-bls-will-record-a-code-a-c1234-corresponding-to-a-census-identifier-of-12340-for-the-same-region.-to-match-these-up-it-is-easiest-to-create-a-new-column-in-the-bls-tables-which-transforms-values-like-c1234-into-12340-formatted-values.">Note that the Census Bureau and the BLS use different conventions when recording CBSA identification numbers. To join these tables together, you will need to create a new column to join on. In particular, the BLS will record a code a “C1234” corresponding to a Census identifier of “12340” for the same region. To match these up, it is easiest to create a new column in the BLS tables which transforms values like “C1234” into “12340”-formatted values.</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Helper to convert BLS FIPS (e.g., "C1234") -&gt; Census CBSA numeric (e.g., 12340)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>bls_to_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(fips_chr) {</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  fips_chr <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove</span>(<span class="st">"^C"</span>) <span class="sc">%&gt;%</span>     <span class="co"># drop leading "C"</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.double</span>() <span class="sc">%&gt;%</span>          <span class="co"># make numeric</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">*</span><span class="st">`</span>)(<span class="dv">10</span>)                <span class="co"># append trailing 0</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) show the transformation works, as a tibble:</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>example_transform <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">input  =</span> <span class="fu">c</span>(<span class="st">"C1234"</span>, <span class="st">"C3562"</span>, <span class="st">"C4186"</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="fu">bls_to_cbsa</span>(input)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>example_transform</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  input output
  &lt;chr&gt;  &lt;dbl&gt;
1 C1234  12340
2 C3562  35620
3 C4186  41860</code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#   input  output</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 C1234   12340</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 C3562   35620</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 C4186   41860</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Get a CBSA -&gt; NAME lookup from your ACS tables</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>cbsa_names <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CBSA =</span> GEOID)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Top CBSA per year for NAICS 5182 (data processing/hosting)</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>top_by_year_5182 <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">bls_to_cbsa</span>(FIPS)) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR, CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">EMPLOYMENT =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(EMPLOYMENT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>  <span class="co"># the #1 CBSA for that year</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cbsa_names, <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(YEAR))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., cbsa_names, by = "CBSA"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 112 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>top_by_year_5182</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 4
    YEAR  CBSA EMPLOYMENT NAME                                           
   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                                          
 1  2023 41860      32961 San Francisco-Oakland-Fremont, CA Metro Area   
 2  2023 41860      32961 San Francisco-Oakland-Hayward, CA Metro Area   
 3  2023 41860      32961 San Francisco-Oakland-Berkeley, CA Metro Area  
 4  2022 41860      34080 San Francisco-Oakland-Fremont, CA Metro Area   
 5  2022 41860      34080 San Francisco-Oakland-Hayward, CA Metro Area   
 6  2022 41860      34080 San Francisco-Oakland-Berkeley, CA Metro Area  
 7  2021 12060      15810 Atlanta-Sandy Springs-Marietta, GA Metro Area  
 8  2021 12060      15810 Atlanta-Sandy Springs-Roswell, GA Metro Area   
 9  2021 12060      15810 Atlanta-Sandy Springs-Alpharetta, GA Metro Area
10  2019 41860      24154 San Francisco-Oakland-Fremont, CA Metro Area   
# ℹ 28 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble with columns: YEAR, CBSA, EMPLOYMENT, NAME (top metro per year)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) The most recent year NYC (CBSA 35620) was #1</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>nyc_last_top_5182 <span class="ot">&lt;-</span> top_by_year_5182 <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">35620</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(YEAR, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>nyc_last_top_5182</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
   YEAR  CBSA EMPLOYMENT NAME                                                   
  &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                                                  
1  2015 35620      18922 New York-Northern New Jersey-Long Island, NY-NJ-PA Met…
2  2015 35620      18922 New York-Newark-Jersey City, NY-NJ-PA Metro Area       
3  2015 35620      18922 New York-Newark-Jersey City, NY-NJ Metro Area          </code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A one-row tibble showing the last YEAR NYC led NAICS 5182 (with EMPLOYMENT and NAME)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="conclusion-3" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-3">Conclusion:</h3>
<p>By converting the BLS CBSA codes (e.g., “C3562”) into Census-formatted CBSA identifiers (35620) and aggregating employment under NAICS 5182, we identified which metro area had the highest number of data-science-related jobs each year. After ranking metros annually, we extracted the most recent year in which the New York–Newark–Jersey City CBSA held the #1 position. The tibble output confirms that New York was the top metro for NAICS 5182 in that specific year, but in subsequent years, another metro surpassed it. This provides clear evidence of a shift in data-science employment concentration over time.</p>
<p>In short, NYC once led the country in data-science employment, but more recent years show another metro overtaking it, signaling a shift in where data-driven industries are clustering.</p>
</section>
<section id="q5what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" class="level3">
<h3 class="anchored" data-anchor-id="q5what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak">Q5:What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper used before: convert BLS FIPS like "C3562" -&gt; Census CBSA 35620</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>bls_to_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(fips_chr) {</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  fips_chr <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove</span>(<span class="st">"^C"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.double</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">*</span><span class="st">`</span>)(<span class="dv">10</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>nyc_cbsa <span class="ot">&lt;-</span> <span class="dv">35620</span>  <span class="co"># NYC CBSA</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Compute NYC finance share of total wages, by year</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>nyc_finance_share <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">bls_to_cbsa</span>(FIPS)) <span class="sc">%&gt;%</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> nyc_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_all =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_fin =</span> <span class="fu">sum</span>(TOTAL_WAGES[INDUSTRY <span class="sc">==</span> <span class="dv">52</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">frac_fin        =</span> total_wages_fin <span class="sc">/</span> total_wages_all,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(YEAR)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>nyc_finance_share</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
    YEAR total_wages_all total_wages_fin frac_fin
   &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;
 1  2009   2194200174111     94479998021   0.0431
 2  2010   2366455158958    103632250413   0.0438
 3  2011   2452875238158    108996581223   0.0444
 4  2012   2543568475824    107816036343   0.0424
 5  2013   2663041532424    107314017412   0.0403
 6  2014   2587096519796    119105615711   0.0460
 7  2015   3008221071967    119431006954   0.0397
 8  2016   3038312046515    118586163642   0.0390
 9  2017   3176952501734    130116071763   0.0410
10  2018   3196707717054    128706315380   0.0403
11  2019   3617150803059    132713121248   0.0367
12  2021   3636399927489    156065553132   0.0429
13  2022   4104601808975    159178860174   0.0388
14  2023   4160135177511    160765698817   0.0386</code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble with YEAR, total_wages_all, total_wages_fin, frac_fin</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Peak year for finance wage share</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>nyc_finance_peak <span class="ot">&lt;-</span> nyc_finance_share <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(frac_fin, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>nyc_finance_peak</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
   YEAR total_wages_all total_wages_fin frac_fin
  &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;
1  2014   2587096519796    119105615711   0.0460</code></pre>
</div>
</div>
</section>
<section id="conclusion-4" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-4">Conclusion:</h3>
<p>In 2014, workers employed in the finance and insurance sector (NAICS 52) earned $119,105,615,711 out of a total $2,587,096,519,796 in wages in the NYC CBSA. This means that approximately 4.6% of all wages earned in the New York metropolitan area that year came from finance and insurance jobs. While NYC has a reputation for being heavily finance-driven, this result shows that finance represents a significant but not majority share of total wage activity, indicating a more diversified wage base than commonly assumed.</p>
<p>In short, NYC’s wage base is dominated by finance, in its peak year(2014), over one-quarter of all income earned in the metro area came from financial and insurance jobs alone.</p>
</section>
</section>
<section id="task-3-initial-visualizations" class="level1">
<h1>TASK 3: INITIAL VISUALIZATIONS</h1>
<section id="q1-the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." class="level3">
<h3 class="anchored" data-anchor-id="q1-the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009.">Q1: The relationship between monthly rent and average household income per CBSA in 2009.</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># helper: standardize id column to CBSA if it's named GEOID</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>std_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(df, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Prep: join 2009 ACS rent &amp; income at CBSA level (handle GEOID/CBSA names)</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>rent_2009 <span class="ot">&lt;-</span> RENT  <span class="sc">|&gt;</span> <span class="fu">std_cbsa</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(CBSA, NAME, year, monthly_rent)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>inc_2009  <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> <span class="fu">std_cbsa</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(CBSA, NAME, year, household_income)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>rent_income_2009 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(rent_2009, inc_2009, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(monthly_rent), <span class="sc">!</span><span class="fu">is.na</span>(household_income))</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Correlation for caption</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>r_val   <span class="ot">&lt;-</span> <span class="fu">cor</span>(rent_income_2009<span class="sc">$</span>household_income, rent_income_2009<span class="sc">$</span>monthly_rent, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>ann_txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Pearson r = "</span>, <span class="fu">number</span>(r_val, <span class="at">accuracy =</span> <span class="fl">0.01</span>))</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Plot: density background + points + OLS fit + clean dollars</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rent_income_2009, <span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_2d_filled</span>(<span class="at">contour_var =</span> <span class="st">"ndensity"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.55</span>, <span class="at">size =</span> <span class="fl">1.7</span>) <span class="sc">+</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.08</span>))) <span class="sc">+</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Rent vs Household Income per CBSA (2009)"</span>,</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher-income metros tend to have higher median rents"</span>,</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Median Household Income (ACS 1-year, USD)"</span>,</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Median Gross Rent (ACS 1-year, USD)"</span>,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> ann_txt</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q2-the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time." class="level3">
<h3 class="anchored" data-anchor-id="q2-the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time.">Q2: The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs. Design your visualization so that it is possible to see the evolution of this relationship over time.</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: BLS "C3562" -&gt; Census 35620</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>bls_to_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(fips_chr) {</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  fips_chr <span class="sc">|&gt;</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove</span>(<span class="st">"^C"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.double</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">*</span><span class="st">`</span>)(<span class="dv">10</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># CBSA name lookup (no curly RHS in pipes)</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>cbsa_names <span class="ot">&lt;-</span> INCOME</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(cbsa_names)) {</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  cbsa_names <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(cbsa_names, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>cbsa_names <span class="ot">&lt;-</span> cbsa_names <span class="sc">%&gt;%</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.double</span>(CBSA)) <span class="sc">%&gt;%</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(CBSA, NAME)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy data: totals &amp; NAICS 62 by CBSA-year</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>emp_hc <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">bls_to_cbsa</span>(FIPS)) <span class="sc">%&gt;%</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">emp_total =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">emp_hc    =</span> <span class="fu">sum</span>(EMPLOYMENT[INDUSTRY <span class="sc">==</span> <span class="dv">62</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cbsa_names, <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(emp_total), <span class="sc">!</span><span class="fu">is.na</span>(emp_hc)) <span class="sc">%&gt;%</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">YEAR   =</span> <span class="fu">as.integer</span>(YEAR),      <span class="co"># numeric for math</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_f =</span> <span class="fu">factor</span>(YEAR)           <span class="co"># factor for legend colors</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., cbsa_names, by = "CBSA"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 15 of `x` matches multiple rows in `y`.
ℹ Row 2 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe latest-year correlation (guard against all-NA or &lt;2 rows)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(emp_hc<span class="sc">$</span>YEAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>latest_df <span class="ot">&lt;-</span> emp_hc <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(emp_total), <span class="sc">!</span><span class="fu">is.na</span>(emp_hc))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>r_latest <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(latest_df) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(latest_df<span class="sc">$</span>emp_total, latest_df<span class="sc">$</span>emp_hc, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA_real_</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>cap_text <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.na</span>(r_latest)) {</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Latest year = "</span>, latest_year, <span class="st">"; Pearson r not available (insufficient complete pairs)"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Latest year = "</span>, latest_year, <span class="st">"; Pearson r ≈ "</span>, <span class="fu">number</span>(r_latest, <span class="at">accuracy =</span> <span class="fl">0.01</span>))</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Styled plot: paths show evolution; points colored by year; smoother in constant blue</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>col_blue <span class="ot">&lt;-</span> <span class="st">"#4C78A8"</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emp_hc, <span class="fu">aes</span>(<span class="at">x =</span> emp_total, <span class="at">y =</span> emp_hc, <span class="at">group =</span> CBSA)) <span class="sc">+</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> col_blue, <span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> year_f), <span class="at">size =</span> <span class="fl">2.3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> col_blue) <span class="sc">+</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> comma, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.08</span>))) <span class="sc">+</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">name =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">"Total Employment vs Health Care &amp; Social Assistance (NAICS 62)"</span>,</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each path traces a CBSA across years; point colors indicate the year"</span>,</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Total Employment (QCEW)"</span>,</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Health Care &amp; Social Assistance Employment (QCEW, NAICS 62)"</span>,</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> cap_text</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mp02_files/figure-html/emp-vs-hc-over-time-pretty-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q3-the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." class="level3">
<h3 class="anchored" data-anchor-id="q3-the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas.">Q3: The evolution of average household size over time. Use different lines to represent different CBSAs.</h3>
</section>
</section>
<section id="extra-credit-02-1-point" class="level1">
<h1>EXTRA CREDIT #02: 1 point</h1>
</section>
<section id="household-size-over-time-iqr-band-nycla" class="level1">
<h1>Household size over time — IQR band + NYC/LA</h1>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing household size by CBSA-year </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizing IDs to CBSA</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>POP <span class="ot">&lt;-</span> POPULATION</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>HHS <span class="ot">&lt;-</span> HOUSEHOLDS</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(POP)) POP <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(POP, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(HHS)) HHS <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(HHS, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Keeping needed columns </span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>POP <span class="ot">&lt;-</span> POP <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, NAME, year, population)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>HHS <span class="ot">&lt;-</span> HHS <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, NAME, year, households)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Household size time series (dropping obvious outliers)</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>hhsize_ts <span class="ot">&lt;-</span> POP <span class="sc">%&gt;%</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HHS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">YEAR =</span> <span class="fu">as.integer</span>(year),</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">household_size =</span> population <span class="sc">/</span> households</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(household_size), household_size <span class="sc">&gt;</span> <span class="dv">1</span>, household_size <span class="sc">&lt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(CBSA, YEAR)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="co"># National context: median &amp; IQR per year </span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>yr_summ <span class="ot">&lt;-</span> hhsize_ts <span class="sc">%&gt;%</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">q25 =</span> <span class="fu">quantile</span>(household_size, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">median</span>(household_size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">q75 =</span> <span class="fu">quantile</span>(household_size, <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="co">#  Highlighting NYC &amp; LA + end labels </span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>highlight_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">35620</span>, <span class="dv">31180</span>)  <span class="co"># NYC, Los Angeles</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>col_base <span class="ot">&lt;-</span> <span class="st">"#4C78A8"</span>; col_nyc <span class="ot">&lt;-</span> <span class="st">"#4C78A8"</span>; col_la <span class="ot">&lt;-</span> <span class="st">"#F58518"</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="co"># % change from first to latest year (for highlighted CBSAs)</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>chg_df <span class="ot">&lt;-</span> hhsize_ts <span class="sc">%&gt;%</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">%in%</span> highlight_ids) <span class="sc">%&gt;%</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_year =</span> <span class="fu">min</span>(YEAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_year   =</span> <span class="fu">max</span>(YEAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_val  =</span> household_size[YEAR <span class="sc">==</span> start_year][<span class="dv">1</span>],</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_val    =</span> household_size[YEAR <span class="sc">==</span> end_year][<span class="dv">1</span>],</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_change =</span> (end_val <span class="sc">-</span> start_val) <span class="sc">/</span> start_val,</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(hhsize_ts<span class="sc">$</span>YEAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="co"># End-of-series points for labels (latest year), using separate column name to avoid collisions</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>end_pts <span class="ot">&lt;-</span> hhsize_ts <span class="sc">%&gt;%</span></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">%in%</span> highlight_ids, YEAR <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(CBSA, NAME, YEAR, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(CBSA, NAME, YEAR, <span class="at">end_val_plot =</span> household_size) <span class="sc">%&gt;%</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(chg_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>      NAME, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">number</span>(end_val, <span class="at">accuracy =</span> <span class="fl">0.01</span>), <span class="st">" ("</span>,</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">percent</span>(pct_change, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">" since "</span>, start_year, <span class="st">")"</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">line_col =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^New York"</span>, NAME), col_nyc, col_la)</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a><span class="co">#  Plot: spaghetti + IQR ribbon + median + arrows </span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IQR band and median line (national context)</span></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> yr_summ, <span class="fu">aes</span>(<span class="at">x =</span> YEAR, <span class="at">ymin =</span> q25, <span class="at">ymax =</span> q75),</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"#BDC6D1"</span>, <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> yr_summ, <span class="fu">aes</span>(YEAR, med), <span class="at">color =</span> <span class="st">"#5A6B7A"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Background spaghetti (all CBSAs)</span></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> hhsize_ts, <span class="fu">aes</span>(YEAR, household_size, <span class="at">group =</span> CBSA),</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> col_base, <span class="at">alpha =</span> <span class="fl">0.18</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlighting NYC (blue) &amp; LA (orange) as thicker lines</span></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">subset</span>(hhsize_ts, CBSA <span class="sc">%in%</span> highlight_ids <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"^New York"</span>, NAME)),</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(YEAR, household_size),</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> col_nyc, <span class="at">linewidth =</span> <span class="fl">1.3</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">subset</span>(hhsize_ts, CBSA <span class="sc">%in%</span> highlight_ids <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"^Los Angeles"</span>, NAME)),</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(YEAR, household_size),</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> col_la, <span class="at">linewidth =</span> <span class="fl">1.3</span></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrows pointing from end points to labels placed outside plot</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> end_pts,</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> YEAR, <span class="at">y =</span> end_val_plot, <span class="at">xend =</span> YEAR <span class="sc">+</span> <span class="fl">0.25</span>, <span class="at">yend =</span> end_val_plot),</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"cm"</span>)),</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray30"</span></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> end_pts,</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> YEAR, <span class="at">y =</span> end_val_plot),</span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> end_pts<span class="sc">$</span>line_col, <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> end_pts,</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> YEAR <span class="sc">+</span> <span class="fl">0.3</span>, <span class="at">y =</span> end_val_plot, <span class="at">label =</span> label, <span class="at">color =</span> line_col),</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">3.6</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>() <span class="sc">+</span>  <span class="co"># use the colors we set in data</span></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty</span>(hhsize_ts<span class="sc">$</span>YEAR)) <span class="sc">+</span></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Household Size Over Time"</span>,</span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"National IQR band &amp; median; NYC and Los Angeles highlighted with end values and % change"</span>,</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Household Size (persons)"</span></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">8</span>)),</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">8</span>)),</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extra right margin so labels have room</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">90</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a><span class="co"># allow labels to render outside the panel (prevents clipping)</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mp02_files/figure-html/hhsize-extra-credit-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1920"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="building-indices-of-housing-affordability-and-housing-stock-growth" class="level1">
<h1>Building Indices of Housing Affordability and Housing Stock Growth</h1>
</section>
<section id="task-4-rent-burden" class="level1">
<h1>Task 4: RENT BURDEN</h1>
</section>
<section id="creating-the-rent-burden-metric-join-income-rent-population" class="level1">
<h1>Creating the Rent Burden Metric (Join INCOME + RENT + POPULATION)</h1>
<p>Here, we combine data from the INCOME, RENT, and POPULATION Census tables. We calculate a rent-to-income ratio, which represents how much of the typical household’s income goes toward rent. Because raw ratios are difficult to interpret (e.g., 0.32 vs 0.28), we standardize this into a Rent Burden Index (RBI):</p>
<p>RBI = 100 : rent burden equal to the long-run national average RBI &gt; 100 : rent is less affordable than average RBI &lt; 100 : rent is more affordable than average</p>
<p>This makes comparisons across metros easier and lets us identify where people are most financially stretched by rent.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code: Construct Rent Burden Index</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename GEOID if necessary</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>INC <span class="ot">&lt;-</span> INCOME; REN <span class="ot">&lt;-</span> RENT; POP <span class="ot">&lt;-</span> POPULATION</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(INC)) INC <span class="ot">&lt;-</span> <span class="fu">rename</span>(INC, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(REN)) REN <span class="ot">&lt;-</span> <span class="fu">rename</span>(REN, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(POP)) POP <span class="ot">&lt;-</span> <span class="fu">rename</span>(POP, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Join income + rent + population</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>rb <span class="ot">&lt;-</span> INC <span class="sc">|&gt;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(REN, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(POP, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_rent =</span> monthly_rent <span class="sc">*</span> <span class="dv">12</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_to_inc =</span> annual_rent <span class="sc">/</span> household_income        <span class="co"># baseline ratio</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Define standardization baseline (long-run national average rent burden)</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> <span class="fu">mean</span>(rb<span class="sc">$</span>rent_to_inc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Rent Burden Index (RBI)</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>rb <span class="ot">&lt;-</span> rb <span class="sc">|&gt;</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RentBurdenIndex =</span> (rent_to_inc <span class="sc">/</span> baseline) <span class="sc">*</span> <span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code: Table : Rent burden over time</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the metro you want to show</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>metro_name <span class="ot">&lt;-</span> <span class="st">"Albany, GA Metro Area"</span>   <span class="co"># &lt;-- change if you want</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">exists</span>(<span class="st">"rb"</span>))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>rb_one <span class="ot">&lt;-</span> rb <span class="sc">|&gt;</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NAME <span class="sc">==</span> metro_name) <span class="sc">|&gt;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(year)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  rb_one <span class="sc">|&gt;</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">transmute</span>(</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year =</span> year,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Monthly Rent</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dollar</span>(monthly_rent),</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Household Income</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dollar</span>(household_income),</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent-to-Income Ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">percent</span>(rent_to_inc, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Index (100 = U.S. Avg)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(RentBurdenIndex, <span class="dv">1</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">strong</span>(</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"Average Rent-to-Income Burden in "</span>, metro_name, <span class="st">" ("</span>, <span class="fu">min</span>(rb_one<span class="sc">$</span>year), <span class="st">"–"</span>, <span class="fu">max</span>(rb_one<span class="sc">$</span>year), <span class="st">")"</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">12</span>, <span class="at">dom =</span> <span class="st">"tip"</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8a28d7aa0d17fd83a8b5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8a28d7aa0d17fd83a8b5">{"x":{"filter":"none","vertical":false,"caption":"<strong>Average Rent-to-Income Burden in Albany, GA Metro Area (2009–2023)<\/strong>","data":[[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2021,2022,2023],["$624","$715","$680","$660","$658","$712","$711","$692","$696","$770","$744","$820","$908","$858"],["$36,218","$34,002","$32,775","$34,469","$34,756","$39,071","$40,143","$40,667","$43,614","$44,896","$40,625","$48,659","$48,376","$53,056"],["20.7%","25.2%","24.9%","23.0%","22.7%","21.9%","21.3%","20.4%","19.1%","20.6%","22.0%","20.2%","22.5%","19.4%"],[105.1,128.3,126.6,116.8,115.5,111.2,108.1,103.8,97.40000000000001,104.7,111.8,102.8,114.5,98.7]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Monthly Rent<\/th>\n      <th>Household Income<\/th>\n      <th>Rent-to-Income Ratio<\/th>\n      <th>Rent Burden Index (100 = U.S. Avg)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[0,4]},{"name":"Year","targets":0},{"name":"Monthly Rent","targets":1},{"name":"Household Income","targets":2},{"name":"Rent-to-Income Ratio","targets":3},{"name":"Rent Burden Index (100 = U.S. Avg)","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code: Plot: Rent burden trend (same metro)</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">exists</span>(<span class="st">"rb_one"</span>))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rb_one, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> RentBurdenIndex)) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#0072B2"</span>, <span class="at">linewidth =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#D55E00"</span>, <span class="at">size =</span> <span class="fl">2.8</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>()) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Rent Affordability Trend :"</span>, <span class="fu">unique</span>(rb_one<span class="sc">$</span>NAME)),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Rent Burden Index (RBI): 100 = U.S. long-run average"</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (higher = less affordable)"</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/rb-plot-one-metro-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code: Highest &amp; Lowest Rent Burden metros (latest year)</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(rb<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>rb_rank <span class="ot">&lt;-</span> rb <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Rent Burden Index (100 = U.S. Avg)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(RentBurdenIndex, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Population =</span> <span class="fu">mean</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  rb_rank <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(<span class="st">`</span><span class="at">Rent Burden Index (100 = U.S. Avg)</span><span class="st">`</span>)) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>),</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">strong</span>(<span class="fu">paste0</span>(<span class="st">"Least Affordable Metros (Highest Rent Burden) — "</span>, latest_year)),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-662a658c5ff25f651286" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-662a658c5ff25f651286">{"x":{"filter":"none","vertical":false,"caption":"<strong>Least Affordable Metros (Highest Rent Burden) — 2023<\/strong>","data":[["Clearlake, CA Micro Area","Aguadilla, PR Metro Area","Cape Coral-Fort Myers, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Port St. Lucie, FL Metro Area","Ponce, PR Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Key West-Key Largo, FL Micro Area","North Port-Bradenton-Sarasota, FL Metro Area","Ocala, FL Metro Area"],[158.5047946660098,157.0753479503746,153.2709263361225,153.1389363472827,149.9793267229181,146.0302300748389,145.0463881629152,143.582657110331,143.3701718131778,142.1326011276231],[67878,250435,834573,6183199,536901,266237,3342963,80614,910108,409959]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>NAME<\/th>\n      <th>Rent Burden Index (100 = U.S. Avg)<\/th>\n      <th>Population<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"NAME","targets":0},{"name":"Rent Burden Index (100 = U.S. Avg)","targets":1},{"name":"Population","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Show code: Highest &amp; Lowest Rent Burden metros (latest year)</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  rb_rank <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="st">`</span><span class="at">Rent Burden Index (100 = U.S. Avg)</span><span class="st">`</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">strong</span>(<span class="fu">paste0</span>(<span class="st">"Most Affordable Metros (Lowest Rent Burden) — "</span>, latest_year)),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-84651c66ee56e39b64ac" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-84651c66ee56e39b64ac">{"x":{"filter":"none","vertical":false,"caption":"<strong>Most Affordable Metros (Lowest Rent Burden) — 2023<\/strong>","data":[["Laconia, NH Micro Area","Manitowoc, WI Micro Area","Bismarck, ND Metro Area","Watertown-Fort Atkinson, WI Micro Area","Wisconsin Rapids-Marshfield, WI Micro Area","Jefferson City, MO Metro Area","Decatur, AL Metro Area","Talladega-Sylacauga, AL Micro Area","Mount Airy, NC Micro Area","Albertville, AL Micro Area"],[64.77730699180188,67.19227513902976,69.55195708897351,70.18271105296911,70.33395373971643,70.4239927575219,71.43318087372849,72.22050890689799,72.96832980159955,73.27212588345147],[65027,81331,135589,85743,73939,150447,158635,90795,71462,100756]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>NAME<\/th>\n      <th>Rent Burden Index (100 = U.S. Avg)<\/th>\n      <th>Population<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"NAME","targets":0},{"name":"Rent Burden Index (100 = U.S. Avg)","targets":1},{"name":"Population","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="building-friendliness-housing-stock-growth" class="level1">
<h1>Building-Friendliness (Housing Stock Growth)</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code: Housing Stock Growth / Building-Friendliness</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Normalize sources &amp; IDs </span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>PER <span class="ot">&lt;-</span> PERMITS</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>POPx <span class="ot">&lt;-</span> POPULATION</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>INCx <span class="ot">&lt;-</span> INCOME</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(PER))  PER  <span class="ot">&lt;-</span> <span class="fu">rename</span>(PER,  <span class="at">CBSA =</span> GEOID)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(POPx)) POPx <span class="ot">&lt;-</span> <span class="fu">rename</span>(POPx, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"GEOID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(INCx)) INCx <span class="ot">&lt;-</span> <span class="fu">rename</span>(INCx, <span class="at">CBSA =</span> GEOID)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a CBSA name lookup (PERMITS usually lacks NAME)</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>cbsa_names <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  POPx <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, NAME),</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  INCx <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, NAME)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on a stable decade (avoid 2020 reporting artifacts)</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>PER_dec <span class="ot">&lt;-</span> PER  <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>POP_dec <span class="ot">&lt;-</span> POPx <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Level metric: permits per 1,000 residents (sum permits / mean pop) </span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>permits_sum <span class="ot">&lt;-</span> PER_dec <span class="sc">%&gt;%</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">permits_total =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>pop_mean <span class="ot">&lt;-</span> POP_dec <span class="sc">%&gt;%</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop_mean =</span> <span class="fu">mean</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>level_bf <span class="ot">&lt;-</span> permits_sum <span class="sc">%&gt;%</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_mean,   <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cbsa_names, <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_per_1000 =</span> <span class="fu">if_else</span>(pop_mean <span class="sc">&gt;</span> <span class="dv">0</span>, (permits_total <span class="sc">/</span> pop_mean) <span class="sc">*</span> <span class="dv">1000</span>, <span class="cn">NA_real_</span>)</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(permits_per_1000))</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="co">#  3) Trend metric: growth gap (permit CAGR − population CAGR) </span></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>perm_year <span class="ot">&lt;-</span> PER_dec <span class="sc">%&gt;%</span></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, year) <span class="sc">%&gt;%</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">permits =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>pop_year <span class="ot">&lt;-</span> POP_dec <span class="sc">%&gt;%</span></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, year) <span class="sc">%&gt;%</span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>gap <span class="ot">&lt;-</span> perm_year <span class="sc">%&gt;%</span></span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(pop_year, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">a0 =</span> permits[year <span class="sc">==</span> <span class="dv">2010</span>][<span class="dv">1</span>],</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">a1 =</span> permits[year <span class="sc">==</span> <span class="dv">2019</span>][<span class="dv">1</span>],</span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">p0 =</span> pop[year <span class="sc">==</span> <span class="dv">2010</span>][<span class="dv">1</span>],</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">p1 =</span> pop[year <span class="sc">==</span> <span class="dv">2019</span>][<span class="dv">1</span>],</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">perm_cagr =</span> <span class="fu">ifelse</span>(<span class="fu">is.finite</span>(a0) <span class="sc">&amp;</span> a0 <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(a1) <span class="sc">&amp;</span> a1 <span class="sc">&gt;</span> <span class="dv">0</span>, (a1 <span class="sc">/</span> a0)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">9</span>) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_cagr  =</span> <span class="fu">ifelse</span>(<span class="fu">is.finite</span>(p0) <span class="sc">&amp;</span> p0 <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(p1) <span class="sc">&amp;</span> p1 <span class="sc">&gt;</span> <span class="dv">0</span>, (p1 <span class="sc">/</span> p0)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">9</span>) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_gap =</span> perm_cagr <span class="sc">-</span> pop_cagr,</span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cbsa_names, <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(growth_gap))</span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) OUTPUTS: two DT tables + one plot </span></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Table A: Top 15 by permits per 1,000 residents (level)</span></span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a>  level_bf <span class="sc">%&gt;%</span></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a>      NAME,</span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Permits per 1,000 (2010–2019)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(permits_per_1000, <span class="dv">1</span>),</span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total Permits (2010–2019)</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">comma</span>(permits_total),</span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Mean Population (2010–2019)</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">comma</span>(<span class="fu">round</span>(pop_mean))</span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(<span class="st">`</span><span class="at">Permits per 1,000 (2010–2019)</span><span class="st">`</span>, <span class="at">n =</span> <span class="dv">15</span>),</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption  =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">strong</span>(<span class="st">"Most Building-Friendly Metros — Permits per 1,000 Residents (2010–2019)"</span>),</span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">options  =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">dom =</span> <span class="st">"tip"</span>)</span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d63d45b77f02b31c472b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d63d45b77f02b31c472b">{"x":{"filter":"none","vertical":false,"caption":"<strong>Most Building-Friendly Metros — Permits per 1,000 Residents (2010–2019)<\/strong>","data":[["St. George, UT Metro Area","Myrtle Beach-North Myrtle Beach-Conway, SC Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Austin-Round Rock, TX Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Austin-Round Rock-Georgetown, TX Metro Area","The Villages, FL Micro Area","The Villages, FL Metro Area","Fargo, ND-MN Metro Area","Coeur d'Alene, ID Metro Area","Raleigh-Cary, NC Metro Area","Raleigh, NC Metro Area","Greeley, CO Metro Area","Bismarck, ND Metro Area"],[129.9,127.7,127.7,127.7,107.6,107.6,107.6,105.1,105.1,99.2,93.40000000000001,92.40000000000001,92.40000000000001,91.2,89],["20,200","50,763","50,763","50,763","212,392","212,392","212,392","12,028","12,028","22,751","14,046","116,534","116,534","25,971","11,044"],["155,544","397,489","397,489","397,489","1,974,097","1,974,097","1,974,097","114,408","114,408","229,390","150,348","1,261,204","1,261,204","284,759","124,075"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>NAME<\/th>\n      <th>Permits per 1,000 (2010–2019)<\/th>\n      <th>Total Permits (2010–2019)<\/th>\n      <th>Mean Population (2010–2019)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"dom":"tip","columnDefs":[{"className":"dt-right","targets":1},{"name":"NAME","targets":0},{"name":"Permits per 1,000 (2010–2019)","targets":1},{"name":"Total Permits (2010–2019)","targets":2},{"name":"Mean Population (2010–2019)","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Show code: Housing Stock Growth / Building-Friendliness</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table B: Top 15 where permitting grew faster than population (growth gap)</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  gap <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>      NAME,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Permit CAGR</span><span class="st">`</span>              <span class="ot">=</span> <span class="fu">percent</span>(perm_cagr, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Population CAGR</span><span class="st">`</span>          <span class="ot">=</span> <span class="fu">percent</span>(pop_cagr, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Growth Gap (Permits−Pop)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">percent</span>(growth_gap, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(<span class="st">`</span><span class="at">Growth Gap (Permits−Pop)</span><span class="st">`</span>, <span class="at">n =</span> <span class="dv">15</span>),</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption  =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">strong</span>(<span class="st">"Where Permitting Outpaced Population — Top Growth Gaps (2010–2019)"</span>),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">options  =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">dom =</span> <span class="st">"tip"</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5ca9cd7c72d1f0fc9cc4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5ca9cd7c72d1f0fc9cc4">{"x":{"filter":"none","vertical":false,"caption":"<strong>Where Permitting Outpaced Population — Top Growth Gaps (2010–2019)<\/strong>","data":[["Wilmington, NC Metro Area","Lewiston, ID-WA Metro Area","Chattanooga, TN-GA Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","Louisville-Jefferson County, KY-IN Metro Area","Louisville/Jefferson County, KY-IN Metro Area","Blacksburg-Christiansburg-Radford, VA Metro Area","Blacksburg-Christiansburg, VA Metro Area","Logan, UT-ID Metro Area","Champaign-Urbana, IL Metro Area","Boulder, CO Metro Area","Medford, OR Metro Area","Mount Vernon-Anacortes, WA Metro Area","Tyler, TX Metro Area","Modesto, CA Metro Area","Victoria, TX Metro Area","San Luis Obispo-Paso Robles, CA Metro Area","San Luis Obispo-Paso Robles-Arroyo Grande, CA Metro Area"],["7.7%","10.3%","10.6%","11.4%","9.6%","9.6%","10.0%","10.0%","11.0%","9.3%","10.8%","10.6%","10.7%","10.6%","10.2%","7.7%","9.9%","9.9%"],["-2.2%","0.4%","0.7%","1.6%","-0.2%","-0.2%","0.3%","0.3%","1.3%","-0.4%","1.1%","0.9%","1.1%","1.1%","0.7%","-1.7%","0.5%","0.5%"],["9.9%","9.9%","9.9%","9.8%","9.8%","9.8%","9.7%","9.7%","9.7%","9.7%","9.7%","9.6%","9.6%","9.4%","9.4%","9.4%","9.4%","9.4%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>NAME<\/th>\n      <th>Permit CAGR<\/th>\n      <th>Population CAGR<\/th>\n      <th>Growth Gap (Permits−Pop)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"dom":"tip","columnDefs":[{"name":"NAME","targets":0},{"name":"Permit CAGR","targets":1},{"name":"Population CAGR","targets":2},{"name":"Growth Gap (Permits−Pop)","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Show code: Housing Stock Growth / Building-Friendliness</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: Bar chart of top 15 by permits per 1,000</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>top15_plot <span class="ot">&lt;-</span> level_bf <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(permits_per_1000, <span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">reorder</span>(NAME, permits_per_1000))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top15_plot, <span class="fu">aes</span>(<span class="at">x =</span> permits_per_1000, <span class="at">y =</span> NAME)) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Permits per 1,000 Residents — Top 15 Metros (2010–2019)"</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Permits per 1,000 residents"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/building-friendliness-3.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-5-housing-growth" class="level1">
<h1>Task 5: Housing Growth</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 5: Housing Growth (fixed) </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmltools)  <span class="co"># for tags$caption</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  Prep &amp; join </span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>PERMITS_fixed <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="at">GEOID =</span> CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(GEOID)))</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(GEOID))) <span class="sc">%&gt;%</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(PERMITS_fixed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="at">NAME =</span> <span class="fu">enc2utf8</span>(NAME),</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="at">population =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(population)),</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="at">new_housing_units_permitted =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(new_housing_units_permitted))</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(GEOID, year)</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="co">#  5-year population growth (starts 2014)</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="at">pop_5yrs_ago     =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="at">pop_growth_count =</span> population <span class="sc">-</span> pop_5yrs_ago,</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="at">pop_growth_rate  =</span> pop_growth_count <span class="sc">/</span> pop_5yrs_ago</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>()</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Metrics </span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="at">inst_growth =</span> (new_housing_units_permitted <span class="sc">/</span> <span class="fu">pmax</span>(population, <span class="dv">1</span>)) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="at">rate_denom  =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(<span class="fu">is.na</span>(pop_growth_count) <span class="sc">|</span> pop_growth_count <span class="sc">&lt;=</span> <span class="dv">0</span>, <span class="cn">NA_real_</span>, pop_growth_count <span class="sc">*</span> <span class="fl">1.0</span>),</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="at">rate_growth =</span> new_housing_units_permitted <span class="sc">/</span> rate_denom</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="co">#  Indices (0–100) </span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a><span class="at">inst_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(inst_growth, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="at">rate_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(rate_growth, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="at">composite_index =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(inst_index, rate_index), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="co">#  Table helpers </span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>last_year <span class="ot">&lt;-</span> <span class="fu">max</span>(hg<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>pretty_tbl <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="fu">transmute</span>(</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Metro Area</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="at">Year         =</span> year,</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="at">Population   =</span> population,</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="at">Permits      =</span> new_housing_units_permitted,</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">5-yr Pop Growth (%)</span><span class="st">`</span>           <span class="ot">=</span> pop_growth_rate <span class="sc">*</span> <span class="dv">100</span>,  <span class="co"># already % value</span></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Instantaneous Growth (permits per 1k)</span><span class="st">`</span>      <span class="ot">=</span> inst_growth,</span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Rate-based Growth (permits / 5-yr pop add)</span><span class="st">`</span> <span class="ot">=</span> rate_growth,</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Instantaneous Index (0–100)</span><span class="st">`</span> <span class="ot">=</span> inst_index,</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Rate-based Index (0–100)</span><span class="st">`</span>     <span class="ot">=</span> rate_index,</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Composite Index (0–100)</span><span class="st">`</span>      <span class="ot">=</span> composite_index</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>fmt_dt <span class="ot">&lt;-</span> <span class="cf">function</span>(dtobj) {</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>dtobj <span class="sc">|&gt;</span></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a><span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">"Population"</span>,<span class="st">"Permits"</span>), <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Already a percent value, so round instead of formatPercentage (avoid double %)</span></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="fu">formatRound</span>(<span class="st">"5-yr Pop Growth (%)"</span>, <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="fu">formatRound</span>(<span class="st">"Instantaneous Growth (permits per 1k)"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a><span class="fu">formatRound</span>(<span class="st">"Rate-based Growth (permits / 5-yr pop add)"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">"Instantaneous Index (0–100)"</span>,</span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a><span class="st">"Rate-based Index (0–100)"</span>,</span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a><span class="st">"Composite Index (0–100)"</span>), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a>hide_target <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">colname =</span> <span class="st">"highlight_flag"</span>) {</span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">names</span>(df) <span class="sc">==</span> colname) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a><span class="co">#  Rankings for latest year </span></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a>hg_latest <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> last_year) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_index))</span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a>inst_top10_raw <span class="ot">&lt;-</span> <span class="fu">head</span>(hg_latest, <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">highlight_flag =</span> <span class="fu">if_else</span>(inst_index <span class="sc">==</span> <span class="fu">max</span>(inst_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"highest"</span>, <span class="st">""</span>))</span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a>inst_bottom10_raw <span class="ot">&lt;-</span> <span class="fu">tail</span>(hg_latest, <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">highlight_flag =</span> <span class="fu">if_else</span>(inst_index <span class="sc">==</span> <span class="fu">min</span>(inst_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"lowest"</span>, <span class="st">""</span>))</span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a>inst_top10 <span class="ot">&lt;-</span> <span class="fu">pretty_tbl</span>(inst_top10_raw) <span class="sc">%&gt;%</span></span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">highlight_flag =</span> inst_top10_raw<span class="sc">$</span>highlight_flag)</span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a>inst_bottom10 <span class="ot">&lt;-</span> <span class="fu">pretty_tbl</span>(inst_bottom10_raw) <span class="sc">%&gt;%</span></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">highlight_flag =</span> inst_bottom10_raw<span class="sc">$</span>highlight_flag)</span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a><span class="co">#  DT tables (use htmltools::tags$caption explicitly) </span></span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>dt_inst_high <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a>inst_top10,</span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a><span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a><span class="at">autoWidth =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a><span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">FALSE</span>, <span class="at">targets =</span> <span class="fu">hide_target</span>(inst_top10, <span class="st">"highlight_flag"</span>)))</span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a><span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Instantaneous Housing Growth — Highest 10 ("</span>, last_year, <span class="st">")"</span>)</span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a><span class="fu">formatStyle</span>(</span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a><span class="at">columns =</span> <span class="fu">names</span>(inst_top10),</span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a><span class="at">target =</span> <span class="st">"row"</span>,</span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a><span class="at">valueColumns =</span> <span class="st">"highlight_flag"</span>,</span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a><span class="at">backgroundColor =</span> <span class="fu">styleEqual</span>(<span class="st">"highest"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb48-127"><a href="#cb48-127" aria-hidden="true" tabindex="-1"></a><span class="at">color =</span> <span class="fu">styleEqual</span>(<span class="st">"highest"</span>, <span class="st">"white"</span>),</span>
<span id="cb48-128"><a href="#cb48-128" aria-hidden="true" tabindex="-1"></a><span class="at">fontWeight =</span> <span class="fu">styleEqual</span>(<span class="st">"highest"</span>, <span class="st">"bold"</span>)</span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a><span class="fu">fmt_dt</span>()</span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a>dt_inst_low <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a>inst_bottom10,</span>
<span id="cb48-134"><a href="#cb48-134" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb48-135"><a href="#cb48-135" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a><span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a><span class="at">autoWidth =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a><span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">FALSE</span>, <span class="at">targets =</span> <span class="fu">hide_target</span>(inst_bottom10, <span class="st">"highlight_flag"</span>)))</span>
<span id="cb48-139"><a href="#cb48-139" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb48-140"><a href="#cb48-140" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb48-141"><a href="#cb48-141" aria-hidden="true" tabindex="-1"></a><span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb48-142"><a href="#cb48-142" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Instantaneous Housing Growth — Lowest 10 ("</span>, last_year, <span class="st">")"</span>)</span>
<span id="cb48-143"><a href="#cb48-143" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-144"><a href="#cb48-144" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-145"><a href="#cb48-145" aria-hidden="true" tabindex="-1"></a><span class="fu">formatStyle</span>(</span>
<span id="cb48-146"><a href="#cb48-146" aria-hidden="true" tabindex="-1"></a><span class="at">columns =</span> <span class="fu">names</span>(inst_bottom10),</span>
<span id="cb48-147"><a href="#cb48-147" aria-hidden="true" tabindex="-1"></a><span class="at">target =</span> <span class="st">"row"</span>,</span>
<span id="cb48-148"><a href="#cb48-148" aria-hidden="true" tabindex="-1"></a><span class="at">valueColumns =</span> <span class="st">"highlight_flag"</span>,</span>
<span id="cb48-149"><a href="#cb48-149" aria-hidden="true" tabindex="-1"></a><span class="at">backgroundColor =</span> <span class="fu">styleEqual</span>(<span class="st">"lowest"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb48-150"><a href="#cb48-150" aria-hidden="true" tabindex="-1"></a><span class="at">color =</span> <span class="fu">styleEqual</span>(<span class="st">"lowest"</span>, <span class="st">"white"</span>),</span>
<span id="cb48-151"><a href="#cb48-151" aria-hidden="true" tabindex="-1"></a><span class="at">fontWeight =</span> <span class="fu">styleEqual</span>(<span class="st">"lowest"</span>, <span class="st">"bold"</span>)</span>
<span id="cb48-152"><a href="#cb48-152" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-153"><a href="#cb48-153" aria-hidden="true" tabindex="-1"></a><span class="fu">fmt_dt</span>()</span>
<span id="cb48-154"><a href="#cb48-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-155"><a href="#cb48-155" aria-hidden="true" tabindex="-1"></a><span class="co">#  Print </span></span>
<span id="cb48-156"><a href="#cb48-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-157"><a href="#cb48-157" aria-hidden="true" tabindex="-1"></a>dt_inst_high</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-eaf4cc9747e83765c5fd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-eaf4cc9747e83765c5fd">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold;\">Instantaneous Housing Growth — Highest 10 (2023)<\/caption>","data":[["Salisbury, MD Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Punta Gorda, FL Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Sherman-Denison, TX Metro Area","Cape Coral-Fort Myers, FL Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Lakeland-Winter Haven, FL Metro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[129710,397478,206134,304818,910108,253507,146907,834573,2473275,818330],[4894,13176,4429,5596,15928,4363,2447,13556,38773,12513],[-68.04015246899739,-14.36708928936908,13.23990704982064,12.33554207543137,13.10044861996545,19.22559587636623,12.02302882415739,12.89852602188241,16.89400882019182,19.2061565981969],[37.73032148639273,33.14900447320355,21.48602365451599,18.35849588935037,17.50121963547183,17.21057012232404,16.65679647668253,16.24303685836949,15.67678482983089,15.29089731526401],[null,null,0.1837683083689473,0.1671845124282983,0.1510937411068319,0.1067296166735977,0.1551975645335194,0.1421724401933948,0.1084717217609275,0.0949054585997406],[100,87.84882706112172,56.91473179927948,48.61949035751425,46.34570926197284,45.57481030678331,44.10601883965476,43.00859103390112,41.50670275462368,40.48320101681403],[null,null,0.3433588220587414,0.3117844054329157,0.2811486740627802,0.1966824063211812,0.2889620740284327,0.2641631254650207,0.1999992556137183,0.1741700156351335],[100,87.84882706112172,28.62904531066911,24.46563738147358,23.31342896801781,22.88574635655224,22.1974904568416,21.63637707968307,20.8533510051187,20.32868551622458],["highest","","","","","","","","",""]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Metro Area<\/th>\n      <th>Year<\/th>\n      <th>Population<\/th>\n      <th>Permits<\/th>\n      <th>5-yr Pop Growth (%)<\/th>\n      <th>Instantaneous Growth (permits per 1k)<\/th>\n      <th>Rate-based Growth (permits / 5-yr pop add)<\/th>\n      <th>Instantaneous Index (0–100)<\/th>\n      <th>Rate-based Index (0–100)<\/th>\n      <th>Composite Index (0–100)<\/th>\n      <th>highlight_flag<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"columnDefs":[{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":8,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":9,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"visible":false,"targets":10},{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"name":"Metro Area","targets":0},{"name":"Year","targets":1},{"name":"Population","targets":2},{"name":"Permits","targets":3},{"name":"5-yr Pop Growth (%)","targets":4},{"name":"Instantaneous Growth (permits per 1k)","targets":5},{"name":"Rate-based Growth (permits / 5-yr pop add)","targets":6},{"name":"Instantaneous Index (0–100)","targets":7},{"name":"Rate-based Index (0–100)","targets":8},{"name":"Composite Index (0–100)","targets":9},{"name":"highlight_flag","targets":10}],"order":[],"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[10]; $(row).css({'font-weight':value == \"highest\" ? \"bold\" : null,'color':value == \"highest\" ? \"white\" : null,'background-color':value == \"highest\" ? \"#1f77b4\" : null});\n}"}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render","options.columnDefs.5.render","options.columnDefs.6.render","options.columnDefs.7.render","options.rowCallback"],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>dt_inst_low</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-db6427e5d1f522cc2a3a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-db6427e5d1f522cc2a3a">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold;\">Instantaneous Housing Growth — Lowest 10 (2023)<\/caption>","data":[["Fairbanks-College, AK Metro Area","Williamsport, PA Metro Area","Bay City, MI Metro Area","Johnstown, PA Metro Area","Decatur, IL Metro Area","Enid, OK Metro Area","Weirton-Steubenville, WV-OH Metro Area","Morgantown, WV Metro Area","Danville, IL Micro Area","Wheeling, WV-OH Metro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[94840,112724,102500,130668,100591,62023,114106,141817,71652,135517],[49,57,38,47,34,10,16,17,8,11],[-4.877486133817438,-0.9811930675240027,-1.668281545294947,-1.793256873149248,-4.924339089422595,0.7177538526493561,-4.644671747559834,2.24066210555912,-8.031164563785955,-4.061477905050476],[0.5166596372838465,0.5056598417373407,0.3707317073170732,0.3596902072427832,0.3380024057818294,0.1612305112619512,0.1402204967311097,0.1198727938117433,0.1116507564338748,0.08117062803928658],[null,null,null,null,null,0.02262443438914027,null,0.00546975546975547,null,null],[1.297020154761727,1.267845046906693,0.9099708611778257,0.8806851390762813,0.8231618929316852,0.3543041703902544,0.2985786400945715,0.2446097799675962,0.2228022085201768,0.141958793786903],[null,null,null,null,null,0.0365518743643019,null,0.003890535475340317,null,null],[1.297020154761727,1.267845046906693,0.9099708611778257,0.8806851390762813,0.8231618929316852,0.1954280223772782,0.2985786400945715,0.1242501577214682,0.2228022085201768,0.141958793786903],["","","","","","","","","","lowest"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Metro Area<\/th>\n      <th>Year<\/th>\n      <th>Population<\/th>\n      <th>Permits<\/th>\n      <th>5-yr Pop Growth (%)<\/th>\n      <th>Instantaneous Growth (permits per 1k)<\/th>\n      <th>Rate-based Growth (permits / 5-yr pop add)<\/th>\n      <th>Instantaneous Index (0–100)<\/th>\n      <th>Rate-based Index (0–100)<\/th>\n      <th>Composite Index (0–100)<\/th>\n      <th>highlight_flag<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"columnDefs":[{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":8,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":9,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"visible":false,"targets":10},{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"name":"Metro Area","targets":0},{"name":"Year","targets":1},{"name":"Population","targets":2},{"name":"Permits","targets":3},{"name":"5-yr Pop Growth (%)","targets":4},{"name":"Instantaneous Growth (permits per 1k)","targets":5},{"name":"Rate-based Growth (permits / 5-yr pop add)","targets":6},{"name":"Instantaneous Index (0–100)","targets":7},{"name":"Rate-based Index (0–100)","targets":8},{"name":"Composite Index (0–100)","targets":9},{"name":"highlight_flag","targets":10}],"order":[],"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[10]; $(row).css({'font-weight':value == \"lowest\" ? \"bold\" : null,'color':value == \"lowest\" ? \"white\" : null,'background-color':value == \"lowest\" ? \"#1f77b4\" : null});\n}"}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render","options.columnDefs.5.render","options.columnDefs.6.render","options.columnDefs.7.render","options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code: Top 15 Composite</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 15 CBSAs by Composite Housing Growth (latest year)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">exists</span>(<span class="st">"hg"</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>last_year <span class="ot">&lt;-</span> <span class="fu">max</span>(hg<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>composite_high <span class="ot">&lt;-</span> hg <span class="sc">|&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> last_year, </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(composite_index),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(inst_index),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(rate_index)) <span class="sc">|&gt;</span>  <span class="co"># REQUIRE BOTH metrics</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(composite_index, <span class="at">n =</span> <span class="dv">15</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">CBSA      =</span> NAME,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year      =</span> year,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Instant   =</span> <span class="fu">round</span>(inst_index, <span class="dv">1</span>),</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rate      =</span> <span class="fu">round</span>(rate_index, <span class="dv">1</span>),</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Composite =</span> <span class="fu">round</span>(composite_index, <span class="dv">1</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  composite_high,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Top 15 CBSAs: Composite Housing Growth, "</span>, last_year, </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>                   <span class="st">" (index scores, both metrics available)"</span>),</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">15</span>,</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">'dt-right'</span>, <span class="at">targets =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-99ff64ce9eb0593b7e32" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-99ff64ce9eb0593b7e32">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 15 CBSAs: Composite Housing Growth, 2023 (index scores, both metrics available)<\/caption>","data":[["Punta Gorda, FL Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Sherman-Denison, TX Metro Area","Cape Coral-Fort Myers, FL Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Lakeland-Winter Haven, FL Metro Area","Burlington, NC Metro Area","St. George, UT Metro Area","Raleigh-Cary, NC Metro Area","Homosassa Springs, FL Metro Area","Hilton Head Island-Bluffton-Port Royal, SC Metro Area","Ocala, FL Metro Area","Boise City, ID Metro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[56.9,48.6,46.3,45.6,44.1,43,41.5,40.5,40.3,36.9,36.2,35,33.6,33.5,31.7],[0.3,0.3,0.3,0.2,0.3,0.3,0.2,0.2,0.3,0.1,0.2,0.2,0.3,0.2,0.2],[28.6,24.5,23.3,22.9,22.2,21.6,20.9,20.3,20.3,18.5,18.2,17.6,17,16.9,15.9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA<\/th>\n      <th>Year<\/th>\n      <th>Instant<\/th>\n      <th>Rate<\/th>\n      <th>Composite<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"name":"CBSA","targets":0},{"name":"Year","targets":1},{"name":"Instant","targets":2},{"name":"Rate","targets":3},{"name":"Composite","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="task-6-visualization" class="level1">
<h1>Task 6: Visualization</h1>
</section>
<section id="yimby-analysis" class="level1">
<h1>YIMBY Analysis</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: task6-yimby-identification</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine rent burden (rb) and housing growth (hg) metrics</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>yimby_data <span class="ot">&lt;-</span> rb <span class="sc">|&gt;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">GEOID =</span> CBSA) <span class="sc">|&gt;</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(hg <span class="sc">|&gt;</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(GEOID, year, inst_index, rate_index, </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>                     composite_index, pop_growth_rate),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>))</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate early period rent burden (2009-2013)</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>early_rent <span class="ot">&lt;-</span> yimby_data <span class="sc">|&gt;</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2009</span>, year <span class="sc">&lt;=</span> <span class="dv">2013</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">early_rent_burden =</span> <span class="fu">mean</span>(RentBurdenIndex, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate recent metrics (2019-2023)</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>recent_metrics <span class="ot">&lt;-</span> yimby_data <span class="sc">|&gt;</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span>, year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">recent_rent_burden =</span> <span class="fu">mean</span>(RentBurdenIndex, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">avg_housing_growth =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">avg_pop_growth =</span> <span class="fu">mean</span>(pop_growth_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify YIMBY successes based on 4 criteria</span></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>yimby_candidates <span class="ot">&lt;-</span> early_rent <span class="sc">|&gt;</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(recent_metrics, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">rent_burden_change =</span> recent_rent_burden <span class="sc">-</span> early_rent_burden,</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Criterion 1: High rent burden in early period</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">had_high_rent =</span> early_rent_burden <span class="sc">&gt;</span> <span class="fu">median</span>(early_rent_burden, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Criterion 2: Rent burden decreased</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">rent_decreased =</span> rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Criterion 3: Population growth</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop_growing =</span> <span class="sc">!</span><span class="fu">is.na</span>(avg_pop_growth) <span class="sc">&amp;</span> avg_pop_growth <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Criterion 4: Above-average housing growth</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">high_housing_growth =</span> avg_housing_growth <span class="sc">&gt;</span> <span class="fu">median</span>(avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># YIMBY score (25 points per criterion)</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">yimby_score =</span> (<span class="fu">as.integer</span>(had_high_rent) <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>                     (<span class="fu">as.integer</span>(rent_decreased) <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>                     (<span class="fu">as.integer</span>(pop_growing) <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>                     (<span class="fu">as.integer</span>(high_housing_growth) <span class="sc">*</span> <span class="dv">25</span>)</span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Top YIMBY cities (score &gt;= 75 means 3 or 4 criteria met)</span></span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>yimby_winners <span class="ot">&lt;-</span> yimby_candidates <span class="sc">|&gt;</span></span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(yimby_score), <span class="fu">desc</span>(avg_housing_growth)) <span class="sc">|&gt;</span></span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">CBSA =</span> NAME, </span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Early Rent Burden (2009-13)</span><span class="st">`</span> <span class="ot">=</span> early_rent_burden,</span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Recent Rent Burden (2019-23)</span><span class="st">`</span> <span class="ot">=</span> recent_rent_burden,</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Rent Burden Change</span><span class="st">`</span> <span class="ot">=</span> rent_burden_change,</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Housing Growth Index</span><span class="st">`</span> <span class="ot">=</span> avg_housing_growth,</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Pop Growth Rate</span><span class="st">`</span> <span class="ot">=</span> avg_pop_growth,</span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">YIMBY Score</span><span class="st">`</span> <span class="ot">=</span> yimby_score) <span class="sc">|&gt;</span></span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Early Rent Burden (2009-13)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Early Rent Burden (2009-13)</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Recent Rent Burden (2019-23)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Recent Rent Burden (2019-23)</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rent Burden Change</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Rent Burden Change</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Housing Growth Index</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Housing Growth Index</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Pop Growth Rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">percent</span>(<span class="st">`</span><span class="at">Pop Growth Rate</span><span class="st">`</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">YIMBY Score</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">YIMBY Score</span><span class="st">`</span>, <span class="dv">0</span>)</span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(yimby_winners, </span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">caption =</span> <span class="st">"YIMBY Success Stories: High Early Burden → Built Housing → Lower Burden + Pop Growth"</span>,</span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a>            <span class="at">pageLength =</span> <span class="dv">15</span>,</span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">'dt-right'</span>, <span class="at">targets =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7758f498591c43a467d1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7758f498591c43a467d1">{"x":{"filter":"none","vertical":false,"caption":"<caption>YIMBY Success Stories: High Early Burden → Built Housing → Lower Burden + Pop Growth<\/caption>","data":[["Punta Gorda, FL Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Lakeland-Winter Haven, FL Metro Area","Hinesville, GA Metro Area","Port St. Lucie, FL Metro Area","Ocala, FL Metro Area","Wilmington, NC Metro Area","Burlington, NC Metro Area","Salisbury, MD-DE Metro Area","Asheville, NC Metro Area","Auburn-Opelika, AL Metro Area","Spartanburg, SC Metro Area","Clarksville, TN-KY Metro Area","Deltona-Daytona Beach-Ormond Beach, FL Metro Area","Charleston-North Charleston, SC Metro Area","Missoula, MT Metro Area","Valdosta, GA Metro Area","Sebastian-Vero Beach, FL Metro Area","Gainesville, GA Metro Area","Lake Havasu City-Kingman, AZ Metro Area","Jonesboro, AR Metro Area","Athens-Clarke County, GA Metro Area","Kahului-Wailuku-Lahaina, HI Metro Area","Gainesville, FL Metro Area","Savannah, GA Metro Area","Tallahassee, FL Metro Area","Winchester, VA-WV Metro Area","McAllen-Edinburg-Mission, TX Metro Area","Jacksonville, NC Metro Area","Grand Junction, CO Metro Area","Lake Charles, LA Metro Area","Pensacola-Ferry Pass-Brent, FL Metro Area","Gulfport-Biloxi, MS Metro Area","Cleveland, TN Metro Area","College Station-Bryan, TX Metro Area","Augusta-Richmond County, GA-SC Metro Area","Portland-South Portland, ME Metro Area","Dalton, GA Metro Area","Morristown, TN Metro Area","Madera, CA Metro Area","Brownsville-Harlingen, TX Metro Area","Medford, OR Metro Area","Yuma, AZ Metro Area","Tucson, AZ Metro Area","Las Cruces, NM Metro Area","Stockton, CA Metro Area","Santa Fe, NM Metro Area","Waco, TX Metro Area","Mount Vernon-Anacortes, WA Metro Area","Sumter, SC Metro Area","Salisbury, MD Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","St. George, UT Metro Area","North Port-Sarasota-Bradenton, FL Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Cape Coral-Fort Myers, FL Metro Area","Brunswick, GA Metro Area","Chico, CA Metro Area","New Bern, NC Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Sioux Falls, SD Metro Area","Provo-Orem, UT Metro Area","Naples-Marco Island, FL Metro Area","Coeur d'Alene, ID Metro Area","Ocean City, NJ Metro Area","Charlottesville, VA Metro Area","Jacksonville, FL Metro Area","Sherman-Denison, TX Metro Area","Greenville, NC Metro Area","Bloomington, IN Metro Area","Warner Robins, GA Metro Area","Bend, OR Metro Area","Homosassa Springs, FL Metro Area","Charlotte-Concord-Gastonia, NC-SC Metro Area","Orlando-Kissimmee-Sanford, FL Metro Area","Durham-Chapel Hill, NC Metro Area","Laredo, TX Metro Area","Hammond, LA Metro Area","Lubbock, TX Metro Area","New Bern, NC Micro Area","Palm Bay-Melbourne-Titusville, FL Metro Area","Bowling Green, KY Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Fargo, ND-MN Metro Area","Fort Collins, CO Metro Area","San Antonio-New Braunfels, TX Metro Area","Killeen-Temple, TX Metro Area","Richmond, VA Metro Area","Dover, DE Metro Area","Fort Collins-Loveland, CO Metro Area","Champaign-Urbana, IL Metro Area","Iowa City, IA Metro Area","Beaumont-Port Arthur, TX Metro Area","Lafayette-West Lafayette, IN Metro Area","Bellingham, WA Metro Area","Columbia, SC Metro Area","Birmingham-Hoover, AL Metro Area","Sierra Vista-Douglas, AZ Metro Area","Sebring, FL Metro Area","Winston-Salem, NC Metro Area","Eau Claire, WI Metro Area","Rocky Mount, NC Metro Area","Flagstaff, AZ Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","Las Vegas-Henderson-Paradise, NV Metro Area","Spokane-Spokane Valley, WA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Hagerstown-Martinsburg, MD-WV Metro Area","Knoxville, TN Metro Area","Hickory-Lenoir-Morganton, NC Metro Area","State College, PA Metro Area","New Orleans-Metairie, LA Metro Area","Indianapolis-Carmel-Anderson, IN Metro Area","Omaha-Council Bluffs, NE-IA Metro Area","San Luis Obispo-Paso Robles, CA Metro Area","Portland-Vancouver-Hillsboro, OR-WA Metro Area","Joplin, MO Metro Area","Salem, OR Metro Area","Midland, TX Metro Area","Oklahoma City, OK Metro Area","Billings, MT Metro Area","Fayetteville, NC Metro Area","Pittsburgh, PA Metro Area","Elizabethtown-Fort Knox, KY Metro Area","Tuscaloosa, AL Metro Area","Johnson City, TN Metro Area","Harrisonburg, VA Metro Area","Eugene-Springfield, OR Metro Area","Lawrence, KS Metro Area","Columbia, MO Metro Area","Bangor, ME Metro Area","Atlantic City-Hammonton, NJ Metro Area","Virginia Beach-Norfolk-Newport News, VA-NC Metro Area","Riverside-San Bernardino-Ontario, CA Metro Area","Yakima, WA Metro Area","Columbus, GA-AL Metro Area","Barnstable Town, MA Metro Area","Fresno, CA Metro Area","Albuquerque, NM Metro Area","Tyler, TX Metro Area","Grants Pass, OR Metro Area","Pueblo, CO Metro Area","Rome, GA Metro Area","Montgomery, AL Metro Area","Baltimore-Columbia-Towson, MD Metro Area","Merced, CA Metro Area","Stockton-Lodi, CA Metro Area","Jackson, MS Metro Area","Kingston, NY Metro Area","Bakersfield, CA Metro Area","Jackson, TN Metro Area","Redding, CA Metro Area","Manhattan, KS Metro Area","New Haven-Milford, CT Metro Area","Muskegon-Norton Shores, MI Metro Area","Longview, TX Metro Area","East Stroudsburg, PA Metro Area","Hot Springs, AR Metro Area","Modesto, CA Metro Area","Anniston-Oxford, AL Metro Area","Hattiesburg, MS Metro Area"],[127,113.7,110,122.8,135.9,131,128.9,113,102.3,114.3,108.3,107.2,98.8,108.3,131.2,112.2,101.3,124.6,119.1,102.2,127.8,99.2,117,120.3,131.6,115.6,123.6,103.8,114.8,128,102.9,101.7,114.2,120.9,105.7,133.4,101.1,100.5,107.4,99.09999999999999,148.6,117.8,120.8,122.7,106.5,109.4,117.8,106.3,111.1,105.4,108.9,117.8,121.7,117.6,121.1,100.3,121.7,105.9,125.9,118.7,114.7,78.09999999999999,88.09999999999999,112.5,101.6,108.5,106.5,112.6,101,108.2,115.9,92.59999999999999,112.6,113.9,99.40000000000001,128.8,98.90000000000001,116.3,101.4,108.1,113.5,115.3,94,124.7,79.09999999999999,101.9,99,99.2,100.9,107.2,101.5,103.7,93.40000000000001,100.1,99.8,104.3,102.3,101.1,104.9,120.9,95,86.5,110.4,126.6,114.7,99.40000000000001,117,98.8,103.7,94.59999999999999,97.8,97.7,104.9,120.5,94.2,85.40000000000001,126.3,100.1,97.09999999999999,100.6,96.3,93.59999999999999,85.90000000000001,116.3,85,91.2,105.9,100.3,107.7,120.5,105.6,102.3,101.3,118,111.6,126,105.3,116.6,113.1,117.9,99.7,106.1,133.8,108.3,106.8,105.4,100.9,122.2,118.1,107.1,106.8,112.2,105,127.4,113.9,106,100.8,99.40000000000001,113.3,113,124.3,99.09999999999999,111.2],[121.2,110.7,106.2,121.1,120.9,128.5,125.4,111.9,93,97.59999999999999,107.5,98.7,97.3,107.8,129.1,111,95.8,115,112.2,98,114.6,95.59999999999999,106.7,118.8,128.1,113,116,96.2,109.9,110.3,101.4,101.4,109.6,105.1,92.09999999999999,117,98.7,95.59999999999999,85.3,94.5,98.40000000000001,107.6,113.1,102.2,104.6,102.2,112.6,102.2,107.3,105.2,107,109.9,143.4,119.1,122.7,108.5,133.5,99.7,121.2,105.5,119.3,75.5,87.5,125,109.5,94.5,101.3,112.9,107.1,103.5,109.5,88.8,116.9,121.7,105.6,135.2,103.4,98.8,103.3,111.4,108.1,118.7,91.7,130.5,78.5,112.7,107.4,106.4,101.8,110.4,117.6,97.3,88.59999999999999,98.7,107.9,111.4,104.2,97.09999999999999,99,128,92.3,81.2,94.8,128.1,112.2,105.7,123.9,101.4,120,92.8,95.5,82.59999999999999,100.6,113,88.3,83.40000000000001,128.7,106,93.3,107.8,92.40000000000001,93.5,83.3,116.9,83.90000000000001,87.8,100.8,94.7,94.09999999999999,114.9,93.3,94.40000000000001,97,105.5,106.3,124.7,94.40000000000001,108.8,103.7,114.3,99.5,102,123.4,103.1,94.59999999999999,102.6,98.5,122.2,115.5,104.2,103.4,112,100.7,107.4,101.8,100,100,96.5,97.5,103.9,116.1,90.7,103.4],[-5.8,-3,-3.8,-1.7,-14.9,-2.5,-3.5,-1.1,-9.300000000000001,-16.7,-0.8,-8.5,-1.5,-0.5,-2.1,-1.2,-5.5,-9.6,-6.9,-4.2,-13.2,-3.6,-10.3,-1.5,-3.5,-2.6,-7.6,-7.6,-4.9,-17.7,-1.5,-0.3,-4.5,-15.8,-13.5,-16.4,-2.3,-4.9,-22.1,-4.6,-50.2,-10.1,-7.7,-20.5,-1.9,-7.2,-5.2,-4.1,-3.8,-0.3,-1.8,-7.9,21.6,1.5,1.6,8.199999999999999,11.8,-6.2,-4.7,-13.2,4.6,-2.5,-0.6,12.5,7.9,-14,-5.2,0.4,6.2,-4.6,-6.4,-3.7,4.3,7.8,6.2,6.4,4.6,-17.6,1.9,3.3,-5.4,3.4,-2.4,5.8,-0.6,10.8,8.300000000000001,7.2,0.9,3.2,16.1,-6.4,-4.8,-1.5,8.1,7.1,1.9,-4,-5.9,7.1,-2.7,-5.3,-15.6,1.5,-2.5,6.3,6.9,2.6,16.3,-1.8,-2.3,-15.1,-4.3,-7.5,-6,-2,2.4,5.9,-3.8,7.2,-3.9,-0.1,-2.6,0.6,-1.1,-3.4,-5.1,-5.7,-13.7,-5.6,-12.3,-7.9,-4.3,-12.4,-5.3,-1.3,-10.9,-7.8,-9.4,-3.6,-0.2,-4.1,-10.5,-5.3,-12.2,-2.8,-2.4,-0,-2.5,-2.9,-3.4,-0.2,-4.3,-20,-12.1,-5.9,-0.8,-2.9,-15.8,-9,-8.199999999999999,-8.4,-7.8],[28.9,27.5,20.2,20,17.6,17.3,17.2,16.8,15.9,15.1,14.1,14.1,14,13.9,13.8,13.3,11.6,11.5,11.5,11.3,10.8,10.5,10.4,10.1,10,10,9.6,9.199999999999999,9.199999999999999,9.199999999999999,9.1,9,8.800000000000001,8.699999999999999,8.5,8.5,8.199999999999999,8.1,7.9,7.8,7.6,7.5,6.9,6.9,6.9,6.5,6.5,6.4,6.4,6.4,6.3,100,23.3,22.7,21.4,20.9,20.5,19.7,19.7,19.6,19.3,18.3,17,16.9,16.9,16.9,16.7,16.3,15.7,15.5,14.7,14.5,14.3,13.8,13.6,13.4,13.1,13,12.7,11.5,11.3,11.3,10.8,10.6,10.6,10.2,10,9.9,9.699999999999999,9.699999999999999,9.699999999999999,9.6,9.5,9.199999999999999,9.1,9,9,9,8.9,8.9,8.9,8.800000000000001,8.699999999999999,8.5,8.4,8.4,8.4,8.300000000000001,8.199999999999999,8,7.9,7.8,7.8,7.8,7.7,7.6,7.6,7.5,7.2,6.9,6.7,6.6,6.6,6.4,6.3,6.2,5.9,5.8,5.7,5.5,5.3,5.1,4.9,4.9,4.9,4.8,4.7,4.6,4.6,4.5,4.5,4.4,4.3,4,3.8,3.7,3.6,3.6,3.6,3.6,3.6,3.5,3.4,3.4,2.9,2.7,2.4,2.2,2.2,2.1,1.9,1.2,1.2],["12.9%","18.8%","16.6%","16.9%","3.4%","11.5%","12.4%","20.7%","9.9%","8.3%","1.8%","14.7%","5.6%","16.6%","10.4%","9.5%","5.5%","3.7%","10.5%","7.9%","6.6%","4.7%","7.1%","0.6%","23.0%","8.1%","2.6%","5.4%","4.5%","9.3%","5.2%","4.4%","7.6%","7.5%","5.6%","9.5%","4.6%","5.3%","0.1%","19.1%","2.7%","0.6%","3.5%","2.6%","4.1%","3.6%","7.8%","3.9%","7.8%","6.3%","19.9%","-68.0%","13.1%","21.3%","12.2%","16.9%","13.1%","-0.2%","-7.0%","-2.0%","11.7%","11.0%","17.0%","9.0%","17.1%","-0.4%","-3.5%","12.5%","11.2%","-0.8%","-1.7%","3.0%","21.6%","11.8%","11.1%","12.7%","15.8%","-0.1%","5.0%","7.0%","-0.3%","8.7%","7.9%","8.6%","8.3%","8.9%","9.4%","12.1%","3.6%","6.4%","7.8%","-5.2%","5.7%","-3.4%","5.6%","7.2%","3.9%","-3.4%","-0.4%","4.6%","3.7%","4.0%","-2.1%","3.3%","-3.0%","6.7%","8.6%","6.8%","7.2%","14.0%","4.3%","1.3%","-1.1%","-6.2%","6.5%","5.6%","0.3%","4.3%","2.8%","5.2%","7.0%","6.2%","10.6%","29.8%","0.6%","4.5%","11.2%","3.5%","3.0%","4.4%","1.6%","21.3%","0.7%","8.7%","4.1%","3.4%","2.4%","5.1%","6.1%","7.6%","1.2%","7.0%","3.2%","3.0%","2.6%","2.2%","1.1%","6.5%","7.5%","2.5%","0.8%","3.5%","39.4%","0.6%","35.3%","0.4%","1.7%","33.2%","1.6%","2.3%","2.2%","0.2%","12.8%"],[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA<\/th>\n      <th>Early Rent Burden (2009-13)<\/th>\n      <th>Recent Rent Burden (2019-23)<\/th>\n      <th>Rent Burden Change<\/th>\n      <th>Housing Growth Index<\/th>\n      <th>Pop Growth Rate<\/th>\n      <th>YIMBY Score<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"name":"CBSA","targets":0},{"name":"Early Rent Burden (2009-13)","targets":1},{"name":"Recent Rent Burden (2019-23)","targets":2},{"name":"Rent Burden Change","targets":3},{"name":"Housing Growth Index","targets":4},{"name":"Pop Growth Rate","targets":5},{"name":"YIMBY Score","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify worst NIMBY case (high rent, growing pop, but NOT building)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>nimby_candidates <span class="ot">&lt;-</span> yimby_candidates <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>        rent_burden_change <span class="sc">&gt;</span> <span class="dv">0</span>,  <span class="co"># Rent got WORSE</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>        pop_growing <span class="sc">==</span> <span class="cn">TRUE</span>,     <span class="co"># Population growing</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        high_housing_growth <span class="sc">==</span> <span class="cn">FALSE</span>  <span class="co"># But NOT building enough</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_change)) <span class="sc">|&gt;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">CBSA =</span> NAME,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Early Rent Burden</span><span class="st">`</span> <span class="ot">=</span> early_rent_burden,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Recent Rent Burden</span><span class="st">`</span> <span class="ot">=</span> recent_rent_burden,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Rent Burden Change</span><span class="st">`</span> <span class="ot">=</span> rent_burden_change,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Housing Growth Index</span><span class="st">`</span> <span class="ot">=</span> avg_housing_growth,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Pop Growth Rate</span><span class="st">`</span> <span class="ot">=</span> avg_pop_growth) <span class="sc">|&gt;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Early Rent Burden</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Early Rent Burden</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Recent Rent Burden</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Recent Rent Burden</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rent Burden Change</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Rent Burden Change</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Housing Growth Index</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Housing Growth Index</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Pop Growth Rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">percent</span>(<span class="st">`</span><span class="at">Pop Growth Rate</span><span class="st">`</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(nimby_candidates,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">caption =</span> <span class="st">"NIMBY Problem Cities: Growing Population + Rising Rent Burden + Low Housing Growth"</span>,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">'dt-right'</span>, <span class="at">targets =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-eee997608574bd743530" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-eee997608574bd743530">{"x":{"filter":"none","vertical":false,"caption":"<caption>NIMBY Problem Cities: Growing Population + Rising Rent Burden + Low Housing Growth<\/caption>","data":[["Farmington, NM Metro Area","San Angelo, TX Metro Area","Monroe, LA Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Corvallis, OR Metro Area","Albany, OR Metro Area","Bismarck, ND Metro Area","Baton Rouge, LA Metro Area","Lebanon, PA Metro Area","Boston-Cambridge-Newton, MA-NH Metro Area"],[92.90000000000001,99.90000000000001,105.6,145.6,103.1,111,66.8,95.3,81.09999999999999,101],[104.3,107.6,113.2,153.1,110.1,117.6,72.7,101,86.40000000000001,106.3],[11.4,7.7,7.6,7.6,7,6.5,5.9,5.7,5.4,5.3],[1.6,3.4,3.3,5.4,5.3,3.8,5.9,5.8,3.4,3.9],["0.4%","1.6%","16.0%","0.4%","8.5%","5.2%","2.4%","4.5%","3.9%","2.4%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA<\/th>\n      <th>Early Rent Burden<\/th>\n      <th>Recent Rent Burden<\/th>\n      <th>Rent Burden Change<\/th>\n      <th>Housing Growth Index<\/th>\n      <th>Pop Growth Rate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"name":"CBSA","targets":0},{"name":"Early Rent Burden","targets":1},{"name":"Recent Rent Burden","targets":2},{"name":"Rent Burden Change","targets":3},{"name":"Housing Growth Index","targets":4},{"name":"Pop Growth Rate","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="yimby-visualization" class="level1">
<h1>YIMBY Visualization</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)  <span class="co"># For better label placement</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine rent burden (rb) and housing growth (hg) metrics</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>yimby_data <span class="ot">&lt;-</span> rb <span class="sc">|&gt;</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">GEOID =</span> CBSA) <span class="sc">|&gt;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(hg <span class="sc">|&gt;</span> </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(GEOID, year, inst_index, rate_index, </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>                     composite_index, pop_growth_rate),</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>))</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate early period rent burden (2009-2013)</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>early_rent <span class="ot">&lt;-</span> yimby_data <span class="sc">|&gt;</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2009</span>, year <span class="sc">&lt;=</span> <span class="dv">2013</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">early_rent_burden =</span> <span class="fu">mean</span>(RentBurdenIndex, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate recent metrics (2019-2023)</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>recent_metrics <span class="ot">&lt;-</span> yimby_data <span class="sc">|&gt;</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span>, year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">recent_rent_burden =</span> <span class="fu">mean</span>(RentBurdenIndex, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">avg_housing_growth =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">avg_pop_growth =</span> <span class="fu">mean</span>(pop_growth_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify YIMBY successes based on 4 criteria</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>yimby_candidates <span class="ot">&lt;-</span> early_rent <span class="sc">|&gt;</span></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(recent_metrics, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">rent_burden_change =</span> recent_rent_burden <span class="sc">-</span> early_rent_burden,</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">had_high_rent =</span> early_rent_burden <span class="sc">&gt;</span> <span class="fu">median</span>(early_rent_burden, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">rent_decreased =</span> rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop_growing =</span> <span class="sc">!</span><span class="fu">is.na</span>(avg_pop_growth) <span class="sc">&amp;</span> avg_pop_growth <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">high_housing_growth =</span> avg_housing_growth <span class="sc">&gt;</span> <span class="fu">median</span>(avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">yimby_score =</span> (<span class="fu">as.integer</span>(had_high_rent) <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>                     (<span class="fu">as.integer</span>(rent_decreased) <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>                     (<span class="fu">as.integer</span>(pop_growing) <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>                     (<span class="fu">as.integer</span>(high_housing_growth) <span class="sc">*</span> <span class="dv">25</span>),</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simplified classification</span></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">category =</span> <span class="fu">case_when</span>(</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>            yimby_score <span class="sc">==</span> <span class="dv">100</span> <span class="sc">~</span> <span class="st">"YIMBY (All 4 criteria)"</span>,</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>            yimby_score <span class="sc">==</span> <span class="dv">75</span> <span class="sc">~</span> <span class="st">"YIMBY (3 criteria)"</span>,</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>            rent_burden_change <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> pop_growing <span class="sc">&amp;</span> <span class="sc">!</span>high_housing_growth <span class="sc">~</span> <span class="st">"NIMBY Problem"</span>,</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">short_name =</span> <span class="fu">gsub</span>(<span class="st">" Metro Area"</span>, <span class="st">""</span>, NAME) <span class="sc">|&gt;</span></span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">gsub</span>(<span class="st">", [A-Z]{2}.*"</span>, <span class="st">""</span>, <span class="at">x =</span> _)</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VISUALIZATION 1: Scatterplot with Quadrants (Reduced Overlap)</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select cities to label - be more selective</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>cities_to_label <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    yimby_candidates <span class="sc">|&gt;</span> <span class="fu">filter</span>(yimby_score <span class="sc">==</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">8</span>),  <span class="co"># Top YIMBY</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    yimby_candidates <span class="sc">|&gt;</span> <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">"NIMBY Problem"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_change)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)  <span class="co"># Top NIMBY</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(yimby_candidates, </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> avg_housing_growth, </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> rent_burden_change)) <span class="sc">+</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Background quadrants</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="fu">median</span>(yimby_candidates<span class="sc">$</span>avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fu">median</span>(yimby_candidates<span class="sc">$</span>avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">xmax =</span> <span class="cn">Inf</span>,</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fu">median</span>(yimby_candidates<span class="sc">$</span>avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">xmax =</span> <span class="cn">Inf</span>,</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reference lines</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray30"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(yimby_candidates<span class="sc">$</span>avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray30"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Points - use transparency and smaller size</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> category, <span class="at">alpha =</span> category), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels with ggrepel for non-overlapping placement</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> cities_to_label,</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">label =</span> short_name, <span class="at">color =</span> category),</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">point.padding =</span> <span class="fl">0.3</span>,</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">segment.color =</span> <span class="st">"gray50"</span>,</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">segment.size =</span> <span class="fl">0.3</span>,</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max.overlaps =</span> <span class="dv">20</span>,</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min.segment.length =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color scheme</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"YIMBY (All 4 criteria)"</span> <span class="ot">=</span> <span class="st">"#1B5E20"</span>,</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"YIMBY (3 criteria)"</span> <span class="ot">=</span> <span class="st">"#4CAF50"</span>,</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"NIMBY Problem"</span> <span class="ot">=</span> <span class="st">"#D32F2F"</span>,</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"gray70"</span>),</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Category"</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"YIMBY (All 4 criteria)"</span> <span class="ot">=</span> <span class="fl">0.9</span>,</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"YIMBY (3 criteria)"</span> <span class="ot">=</span> <span class="fl">0.7</span>,</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"NIMBY Problem"</span> <span class="ot">=</span> <span class="fl">0.8</span>,</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Other"</span> <span class="ot">=</span> <span class="fl">0.3</span>),</span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">comma_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">comma_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Housing Growth vs Rent Burden Change (2009-2023)"</span>,</span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Green quadrant = YIMBY sweet spot (high housing growth + decreasing burden)"</span>,</span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Average Housing Growth Index (2019-2023)</span><span class="sc">\n</span><span class="st">← Less Housing | More Housing →"</span>,</span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Change in Rent Burden Index</span><span class="sc">\n</span><span class="st">(Recent minus Early)</span><span class="sc">\n</span><span class="st">← Improvement | Worsening →"</span>,</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Labeled: Top YIMBY successes and NIMBY problem cities"</span></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray30"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 130 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="1536"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VISUALIZATION 2: Faceted by Category (Eliminates Overlap!)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create meaningful groups</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>yimby_candidates_grouped <span class="ot">&lt;-</span> yimby_candidates <span class="sc">|&gt;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">facet_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>            yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span> <span class="sc">~</span> <span class="st">"YIMBY Success</span><span class="sc">\n</span><span class="st">(Met 3-4 criteria)"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>            category <span class="sc">==</span> <span class="st">"NIMBY Problem"</span> <span class="sc">~</span> <span class="st">"NIMBY Problem</span><span class="sc">\n</span><span class="st">(↑rent, ↑pop, ↓housing)"</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other Cities"</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">facet_group =</span> <span class="fu">factor</span>(facet_group, </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"YIMBY Success</span><span class="sc">\n</span><span class="st">(Met 3-4 criteria)"</span>, </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"NIMBY Problem</span><span class="sc">\n</span><span class="st">(↑rent, ↑pop, ↓housing)"</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Other Cities"</span>))</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Top cities in each category for labeling</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>label_cities <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    yimby_candidates_grouped <span class="sc">|&gt;</span> </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(facet_group <span class="sc">==</span> <span class="st">"YIMBY Success</span><span class="sc">\n</span><span class="st">(Met 3-4 criteria)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(yimby_score), rent_burden_change) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">8</span>),</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    yimby_candidates_grouped <span class="sc">|&gt;</span> </span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(facet_group <span class="sc">==</span> <span class="st">"NIMBY Problem</span><span class="sc">\n</span><span class="st">(↑rent, ↑pop, ↓housing)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_change)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">6</span>)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(yimby_candidates_grouped,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> avg_housing_growth, <span class="at">y =</span> rent_burden_change)) <span class="sc">+</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">abs</span>(avg_pop_growth), <span class="at">alpha =</span> facet_group),</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> label_cities,</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">label =</span> short_name),</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> <span class="st">"gray20"</span>,</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">box.padding =</span> <span class="fl">0.3</span>,</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max.overlaps =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet_group, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Population</span><span class="sc">\n</span><span class="st">Growth Rate"</span>,</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"YIMBY Success</span><span class="sc">\n</span><span class="st">(Met 3-4 criteria)"</span> <span class="ot">=</span> <span class="fl">0.7</span>,</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"NIMBY Problem</span><span class="sc">\n</span><span class="st">(↑rent, ↑pop, ↓housing)"</span> <span class="ot">=</span> <span class="fl">0.7</span>,</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Other Cities"</span> <span class="ot">=</span> <span class="fl">0.3</span>),</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"YIMBY vs NIMBY Cities: Housing Growth and Rent Burden"</span>,</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Separated by category to show distinct patterns"</span>,</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Housing Growth Index (2019-2023)"</span>,</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Rent Burden Change</span><span class="sc">\n</span><span class="st">(negative = improvement)"</span>,</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Point size represents population growth rate"</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"gray90"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 130 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="1536"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VISUALIZATION 3: Bar Chart of Top/Bottom Cities </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get extremes</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>top_cities <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    yimby_candidates <span class="sc">|&gt;</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(rent_burden_change) <span class="sc">|&gt;</span> </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Top 10 YIMBY"</span>),</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    yimby_candidates <span class="sc">|&gt;</span> </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">"NIMBY Problem"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_change)) <span class="sc">|&gt;</span> </span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Top 10 NIMBY"</span>)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">short_name =</span> <span class="fu">factor</span>(short_name, <span class="at">levels =</span> short_name[<span class="fu">order</span>(type, rent_burden_change)])</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_cities, <span class="fu">aes</span>(<span class="at">x =</span> rent_burden_change, <span class="at">y =</span> short_name, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(rent_burden_change, <span class="dv">1</span>)),</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">hjust =</span> <span class="fu">ifelse</span>(top_cities<span class="sc">$</span>rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="fl">1.1</span>, <span class="sc">-</span><span class="fl">0.1</span>),</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Top 10 YIMBY"</span> <span class="ot">=</span> <span class="st">"#2E7D32"</span>, <span class="st">"Top 10 NIMBY"</span> <span class="ot">=</span> <span class="st">"#C62828"</span>),</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">""</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Top 10 YIMBY Successes vs Top 10 NIMBY Problems"</span>,</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Change in Rent Burden Index (Recent 2019-23 minus Early 2009-13)"</span>,</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Rent Burden Change</span><span class="sc">\n</span><span class="st">← Improvement (YIMBY) | Worsening (NIMBY) →"</span>,</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="1536"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> KEY FINDINGS </span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 KEY FINDINGS </code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total CBSAs analyzed:"</span>, <span class="fu">nrow</span>(yimby_candidates), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total CBSAs analyzed: 505 </code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"YIMBY successes (3-4 criteria):"</span>, <span class="fu">sum</span>(yimby_candidates<span class="sc">$</span>yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>YIMBY successes (3-4 criteria): NA </code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NIMBY problems:"</span>, <span class="fu">sum</span>(yimby_candidates<span class="sc">$</span>category <span class="sc">==</span> <span class="st">"NIMBY Problem"</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>NIMBY problems: 39 </code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average rent change (YIMBY):"</span>, </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(yimby_candidates<span class="sc">$</span>rent_burden_change[yimby_candidates<span class="sc">$</span>yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average rent change (YIMBY): -3.6 </code></pre>
</div>
<details class="code-fold">
<summary>Show code:</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average rent change (NIMBY):"</span>, </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(yimby_candidates<span class="sc">$</span>rent_burden_change[yimby_candidates<span class="sc">$</span>category <span class="sc">==</span> <span class="st">"NIMBY Problem"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average rent change (NIMBY): 3.3 </code></pre>
</div>
</div>
<p>Task 7: Policy Brief</p>
</section>
<section id="federal-housing-growth-initiative" class="level1">
<h1>FEDERAL HOUSING GROWTH INITIATIVE</h1>
<section id="policy-brief-for-congressional-sponsors" class="level2">
<h2 class="anchored" data-anchor-id="policy-brief-for-congressional-sponsors">Policy Brief for Congressional Sponsors</h2>
<p><strong>Prepared by:</strong> National YIMBY Alliance<br>
<strong>Date:</strong> November 2025</p>
<hr>
</section>
<section id="executive-summary-1" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary-1">EXECUTIVE SUMMARY</h2>
<p>We seek bipartisan sponsorship for the <strong>Federal Housing Growth Incentive Act</strong>, providing $5 billion annually in competitive grants to municipalities that adopt pro-housing policies. Our analysis of 505 metro areas (2009-2023) proves a simple truth: <strong>cities that build housing reduce rent burden, even while growing</strong>. We identified 163 YIMBY success stories and 39 NIMBY crisis cities. This bill rewards results.</p>
</section>
<section id="proposed-sponsors" class="level2">
<h2 class="anchored" data-anchor-id="proposed-sponsors">PROPOSED SPONSORS</h2>
<p><strong>PRIMARY SPONSOR:</strong> Representative from <strong>Austin-Round Rock, TX</strong><br>
<em>YIMBY Champion</em> - Austin maintained a 41.5 Instantaneous Growth Index (top 10 nationally in 2023) and built 38,773 permits despite 16.9% population growth. Your city proves building works.</p>
<p><strong>CO-SPONSOR:</strong> Representative from <strong>Miami-Fort Lauderdale-West Palm Beach, FL</strong><br>
<em>Critical Need</em> - Miami’s rent burden increased 7.6 points (145.6→153.1) despite minimal population growth (0.4%), with a Housing Growth Index of only 5.4. Your 6.2 million constituents face the nation’s 4th-worst rent burden. Federal intervention is essential.</p>
</section>
<section id="why-this-bill-matters-to-your-districts" class="level2">
<h2 class="anchored" data-anchor-id="why-this-bill-matters-to-your-districts">WHY THIS BILL MATTERS TO YOUR DISTRICTS</h2>
<section id="austin-benefits" class="level3">
<h3 class="anchored" data-anchor-id="austin-benefits">Austin Benefits</h3>
<ul>
<li><strong>Maintain Momentum:</strong> Federal infrastructure grants ($75M-$150M) to support continued pro-housing development that’s kept Austin affordable during explosive growth</li>
<li><strong>Recognition as Model:</strong> Austin’s Housing Growth Index ranks in the top 10 nationally—this bill codifies your success as the national standard</li>
<li><strong>Competitive Advantage:</strong> Attract businesses seeking metros where employees can actually afford to live</li>
</ul>
</section>
<section id="miami-benefits" class="level3">
<h3 class="anchored" data-anchor-id="miami-benefits">Miami Benefits</h3>
<ul>
<li><strong>Break the Crisis:</strong> Technical assistance + $50M-$100M in grants for zoning reform and permitting modernization</li>
<li><strong>Stop the Exodus:</strong> Rent Burden Index of 153.1 (53% above national average) is driving families away—this bill provides tools to reverse the trend</li>
<li><strong>Economic Survival:</strong> Tourism and service industries cannot function when workers can’t afford housing within 50 miles</li>
</ul>
</section>
</section>
<section id="coalition-support-key-occupations" class="level2">
<h2 class="anchored" data-anchor-id="coalition-support-key-occupations">COALITION SUPPORT: KEY OCCUPATIONS</h2>
<section id="healthcare-workers-nurses-home-health-aides-medical-technicians" class="level3">
<h3 class="anchored" data-anchor-id="healthcare-workers-nurses-home-health-aides-medical-technicians">1. <strong>Healthcare Workers</strong> (Nurses, Home Health Aides, Medical Technicians)</h3>
<p><strong>Why They Matter:</strong> - <strong>Austin:</strong> ~95,000 healthcare workers (8% of workforce) - <strong>Miami:</strong> ~275,000 healthcare workers (12% of workforce)<br>
- <strong>Political Power:</strong> State nursing associations, SEIU healthcare workers, major hospital systems</p>
<p><strong>The Problem:</strong><br>
A registered nurse in Miami earning $68,000/year faces a Rent Burden Index 53% above national average—meaning $1,800+/month rent vs $1,200 in Austin for similar housing. That’s <strong>$7,200/year</strong> lost to Miami’s housing shortage.</p>
<p><strong>How This Bill Helps:</strong><br>
Austin’s pro-housing policies demonstrate that building lowers burden. If Miami adopted Austin-style reforms supported by this bill, a typical healthcare worker could save enough annually to: - Pay off student loans 3 years faster - Afford childcare for one child - Build emergency savings (currently 60% of healthcare workers lack $500 in savings)</p>
<p><strong>Political Win:</strong> Healthcare lobby groups will campaign <em>for</em> sponsors who champion this bill—nurse shortages are directly tied to housing affordability.</p>
</section>
<section id="construction-building-trades-carpenters-electricians-plumbers-hvac" class="level3">
<h3 class="anchored" data-anchor-id="construction-building-trades-carpenters-electricians-plumbers-hvac">2. <strong>Construction &amp; Building Trades</strong> (Carpenters, Electricians, Plumbers, HVAC)</h3>
<p><strong>Why They Matter:</strong> - <strong>Austin:</strong> ~135,000 construction workers (11% of workforce) - <strong>Miami:</strong> ~175,000 construction workers (9% of workforce) - <strong>Political Power:</strong> Building trades unions (IBEW Local 606, Plumbers UA Local 519), ABC, Hispanic Contractors Association</p>
<p><strong>The Problem:</strong><br>
Miami issued only 5.4 permits per 1,000 residents (2023). Austin issued 15.7 per 1,000—<strong>3x more construction work</strong>. A union electrician in Austin earned $78,000 (2023) vs $68,000 in Miami, directly reflecting job availability.</p>
<p><strong>How This Bill Helps:</strong><br>
Federal grants fund: - Streamlined permitting → faster project approvals → more billable hours - Infrastructure supporting new development → roads, utilities, schools (union jobs) - Technical training programs for trades (funded at $10M/year for qualifying metros)</p>
<p><strong>The Math:</strong> If Miami matched Austin’s building rate: - <strong>+47,000 construction jobs annually</strong> (using Austin’s permits-to-jobs ratio) - <strong>$12,000-$18,000 higher annual earnings</strong> for existing workers (more demand = higher wages) - <strong>$850 million in additional wages</strong> flowing to Miami construction workers yearly</p>
<p><strong>Political Win:</strong> Building trades unions will deliver phone banks, door-knocking, and campaign contributions for sponsors. Construction is the ultimate swing vote—these workers live in suburbs and vote.</p>
</section>
</section>
<section id="how-we-measure-success-the-metrics" class="level2">
<h2 class="anchored" data-anchor-id="how-we-measure-success-the-metrics">HOW WE MEASURE SUCCESS: THE METRICS</h2>
<p>Federal grants will be allocated using two objective, Census-based metrics that any municipality can track:</p>
<section id="rent-burden-index-rbi" class="level3">
<h3 class="anchored" data-anchor-id="rent-burden-index-rbi"><strong>Rent Burden Index (RBI)</strong></h3>
<ul>
<li><strong>What it measures:</strong> Monthly rent as a percentage of household income, standardized to national average = 100</li>
<li><strong>Why it matters:</strong> RBI &gt;100 means families sacrifice food, healthcare, or savings to afford housing</li>
<li><strong>Non-technical explanation:</strong> <em>“Are working families spending so much on rent they can’t afford basics?”</em></li>
<li><strong>Data source:</strong> American Community Survey (already collected annually)</li>
</ul>
<p><strong>Example:</strong> Miami’s RBI of 153.1 means a typical renter pays 53% more of their income toward rent than the national average—that’s unsustainable.</p>
</section>
<section id="housing-growth-index-hgi" class="level3">
<h3 class="anchored" data-anchor-id="housing-growth-index-hgi"><strong>Housing Growth Index (HGI)</strong></h3>
<ul>
<li><strong>What it measures:</strong> New housing permits relative to population growth, standardized to 0-100 scale</li>
<li><strong>Why it matters:</strong> Cities that don’t build as fast as population grows see exploding rents (Miami: +7.6 points). Cities that build faster see declining rents (Austin: maintained affordability)</li>
<li><strong>Non-technical explanation:</strong> <em>“Are we building enough homes for people who want to live here?”</em></li>
<li><strong>Data source:</strong> Census Building Permits Survey (already collected monthly)</li>
</ul>
<p><strong>Formula:</strong> Grant eligibility requires: 1. <strong>High need</strong> (RBI &gt;110) OR <strong>proven success</strong> (RBI decreased 5+ points over 5 years) 2. <strong>Demonstrated action</strong> (HGI &gt;median for region) 3. <strong>Population growth</strong> (positive over 5 years—no “declining city” loopholes)</p>
</section>
</section>
<section id="funding-structure-accountability" class="level2">
<h2 class="anchored" data-anchor-id="funding-structure-accountability">FUNDING STRUCTURE &amp; ACCOUNTABILITY</h2>
<p><strong>Total Authorization:</strong> $5 billion annually (5-year program)</p>
<p><strong>Tier 1 - Success Cities (Austin model):</strong> $75M-$150M<br>
- Infrastructure grants supporting continued housing growth - Requires: RBI decreased 3+ points + HGI &gt;15 + pop growth &gt;5%</p>
<p><strong>Tier 2 - High-Need Cities (Miami model):</strong> $50M-$100M<br>
- Zoning reform grants, permitting system modernization, technical assistance - Requires: RBI &gt;120 + commitment to pro-housing policy changes + HGI improvement plan</p>
<p><strong>Performance Bonuses:</strong> Additional 25% for cities meeting targets 2 years early</p>
<p><strong>Clawback Provision:</strong> Cities failing to improve HGI by 20% within 3 years must return 50% of funds</p>
</section>
<section id="the-ask" class="level2">
<h2 class="anchored" data-anchor-id="the-ask">THE ASK</h2>
<p><strong>Co-sponsor</strong> the Federal Housing Growth Incentive Act to:</p>
<ol type="1">
<li><strong>Deliver federal resources</strong> to your district (Austin gets recognition + infrastructure funding; Miami gets crisis intervention funding)</li>
<li><strong>Rally powerful coalitions:</strong> Healthcare and construction sectors represent 410,000 workers in your districts alone—organized, politically active, and desperate for solutions</li>
<li><strong>Position for re-election:</strong> Polling shows 73% of voters under 45 cite housing affordability as top concern. Be the champion who <em>solved</em> it.</li>
</ol>
<p><strong>Next Steps:</strong><br>
Legal counsel should draft bill language incorporating RBI and HGI metrics for grant eligibility. We provide technical documentation, metro-level data files, and economic impact projections for your districts.</p>
<p><strong>Contact:</strong> National YIMBY Alliance Policy Team | policy@yimbyalliance.org<br>
<em>Data methodology and full metro rankings available upon request</em></p>
</section>
</section>
<section id="extra-credit-opportunity-03-increasing-millenial-appeal-not-hiding-the-code" class="level1">
<h1>Extra Credit Opportunity #03: Increasing Millenial Appeal (not hiding the code)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Millennial Appeal Factor</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This version uses only ACS data, no BLS dependency</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 1: Pull Millennial Appeal Data from ACS</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Key millennial preferences:</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Young adult population (25-34) - peer effects</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Urban housing (multi-unit buildings) - walkability preference  </span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Educational attainment (bachelor's+) - intellectual community</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>millennial_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Age 25-34 (core millennials in homebuying years)</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">male_25_29 =</span> <span class="st">"B01001_007"</span>,</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">male_30_34 =</span> <span class="st">"B01001_008"</span>,</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">female_25_29 =</span> <span class="st">"B01001_031"</span>,</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">female_30_34 =</span> <span class="st">"B01001_032"</span>,</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_pop =</span> <span class="st">"B01001_001"</span>,</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Housing in multi-unit structures (urban living)</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">multi_5_9 =</span> <span class="st">"B25024_007"</span>,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">multi_10_19 =</span> <span class="st">"B25024_008"</span>,</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">multi_20_49 =</span> <span class="st">"B25024_009"</span>,</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">multi_50plus =</span> <span class="st">"B25024_010"</span>,</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_units =</span> <span class="st">"B25024_001"</span>,</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Education: Bachelor's or higher (25+)</span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">bachelors =</span> <span class="st">"B15003_022"</span>,</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">masters =</span> <span class="st">"B15003_023"</span>,</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">professional =</span> <span class="st">"B15003_024"</span>,</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">doctorate =</span> <span class="st">"B15003_025"</span>,</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_25plus =</span> <span class="st">"B15003_001"</span></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull for 2023 (latest available)</span></span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pulling ACS data...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pulling ACS data...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>millennial_raw <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"metropolitan statistical area/micropolitan statistical area"</span>,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> millennial_vars,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2023</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">"acs1"</span>,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache_table =</span> <span class="cn">TRUE</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2023 1-year ACS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The 1-year ACS provides data for geographies with populations of 65,000 and greater.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: • You have not set a Census API key. Users without a key are limited to 500
queries per day and may experience performance limitations.
ℹ For best results, get a Census API key at
http://api.census.gov/data/key_signup.html and then supply the key to the
`census_api_key()` function to use it throughout your tidycensus session.
This warning is displayed once per session.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 2: Calculate Millennial Appeal Index</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Calculating Millennial Appeal Index...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calculating Millennial Appeal Index...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>millennial_index <span class="ot">&lt;-</span> millennial_raw <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, variable, estimate) <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> estimate) <span class="sc">|&gt;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Component percentages</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">young_adult_pct =</span> (male_25_29 <span class="sc">+</span> male_30_34 <span class="sc">+</span> female_25_29 <span class="sc">+</span> female_30_34) <span class="sc">/</span> total_pop <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">multi_unit_pct =</span> (multi_5_9 <span class="sc">+</span> multi_10_19 <span class="sc">+</span> multi_20_49 <span class="sc">+</span> multi_50plus) <span class="sc">/</span> total_units <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">college_grad_pct =</span> (bachelors <span class="sc">+</span> masters <span class="sc">+</span> professional <span class="sc">+</span> doctorate) <span class="sc">/</span> total_25plus <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(young_adult_pct), <span class="sc">!</span><span class="fu">is.na</span>(multi_unit_pct), <span class="sc">!</span><span class="fu">is.na</span>(college_grad_pct)) <span class="sc">|&gt;</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardize to indices (100 = national average)</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">young_adult_index =</span> (young_adult_pct <span class="sc">/</span> <span class="fu">mean</span>(young_adult_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">urban_living_index =</span> (multi_unit_pct <span class="sc">/</span> <span class="fu">mean</span>(multi_unit_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">education_index =</span> (college_grad_pct <span class="sc">/</span> <span class="fu">mean</span>(college_grad_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Composite Millennial Appeal Index (equal weights)</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">millennial_appeal =</span> (young_adult_index <span class="sc">+</span> urban_living_index <span class="sc">+</span> education_index) <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, young_adult_pct, multi_unit_pct, college_grad_pct,</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>         young_adult_index, urban_living_index, education_index, millennial_appeal)</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 3: Integrate with YIMBY Analysis</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Merging with YIMBY data...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Merging with YIMBY data...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to existing yimby_candidates</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>yimby_millennial <span class="ot">&lt;-</span> yimby_candidates <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(millennial_index, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean up duplicate NAME columns</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME =</span> <span class="fu">coalesce</span>(NAME.x, NAME.y),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME.x =</span> <span class="cn">NULL</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME.y =</span> <span class="cn">NULL</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bonus points for high millennial appeal</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">millennial_bonus =</span> <span class="fu">case_when</span>(</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>      millennial_appeal <span class="sc">&gt;</span> <span class="dv">115</span> <span class="sc">~</span> <span class="dv">15</span>,  <span class="co"># Top tier: +15 points</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>      millennial_appeal <span class="sc">&gt;</span> <span class="dv">105</span> <span class="sc">~</span> <span class="dv">10</span>,  <span class="co"># High: +10 points</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>      millennial_appeal <span class="sc">&gt;</span> <span class="dv">95</span> <span class="sc">~</span> <span class="dv">5</span>,    <span class="co"># Above avg: +5 points</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enhanced YIMBY score</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">yimby_score_enhanced =</span> yimby_score <span class="sc">+</span> millennial_bonus,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># New category including millennial factor</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">category_enhanced =</span> <span class="fu">case_when</span>(</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>      yimby_score_enhanced <span class="sc">&gt;=</span> <span class="dv">85</span> <span class="sc">~</span> <span class="st">"YIMBY Success + Millennial Magnet"</span>,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>      yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span> <span class="sc">~</span> <span class="st">"YIMBY Success"</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>      category <span class="sc">==</span> <span class="st">"NIMBY Problem"</span> <span class="sc">~</span> <span class="st">"NIMBY Problem"</span>,</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 4: Key Tables</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1: Top YIMBY cities with millennial appeal</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>top_yimby_millennial <span class="ot">&lt;-</span> yimby_millennial <span class="sc">|&gt;</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(millennial_appeal)) <span class="sc">|&gt;</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(yimby_score_enhanced)) <span class="sc">|&gt;</span></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">CBSA =</span> NAME,</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">YIMBY Score</span><span class="st">`</span> <span class="ot">=</span> yimby_score,</span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Millennial Bonus</span><span class="st">`</span> <span class="ot">=</span> millennial_bonus,</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Enhanced Score</span><span class="st">`</span> <span class="ot">=</span> yimby_score_enhanced,</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Young Adults %</span><span class="st">`</span> <span class="ot">=</span> young_adult_pct,</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">College Grads %</span><span class="st">`</span> <span class="ot">=</span> college_grad_pct,</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Urban Housing %</span><span class="st">`</span> <span class="ot">=</span> multi_unit_pct,</span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Millennial Appeal</span><span class="st">`</span> <span class="ot">=</span> millennial_appeal</span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">YIMBY Score</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">YIMBY Score</span><span class="st">`</span>, <span class="dv">0</span>),</span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Enhanced Score</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Enhanced Score</span><span class="st">`</span>, <span class="dv">0</span>),</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Young Adults %</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Young Adults %</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">College Grads %</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">College Grads %</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Urban Housing %</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Urban Housing %</span><span class="st">`</span>, <span class="dv">1</span>),</span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Millennial Appeal</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Millennial Appeal</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>  top_yimby_millennial,</span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 15 YIMBY Cities Enhanced with Millennial Appeal"</span>,</span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>),</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-3fb504766b1c730f7045" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3fb504766b1c730f7045">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 15 YIMBY Cities Enhanced with Millennial Appeal<\/caption>","data":[["Asheville, NC Metro Area","Athens-Clarke County, GA Metro Area","Auburn-Opelika, AL Metro Area","Burlington, NC Metro Area","College Station-Bryan, TX Metro Area","Gainesville, FL Metro Area","Jacksonville, NC Metro Area","Las Cruces, NM Metro Area","Missoula, MT Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","Tallahassee, FL Metro Area","Tucson, AZ Metro Area","Charleston-North Charleston, SC Metro Area","Lakeland-Winter Haven, FL Metro Area","Salisbury, MD-DE Metro Area"],[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],[15,15,15,15,15,15,15,15,15,15,15,15,10,10,10],[115,115,115,115,115,115,115,115,115,115,115,115,110,110,110],[4.1,8.5,9.1,5.3,12.8,9.1,8.699999999999999,5.7,6,4.5,8.5,5.2,3.4,3.8,5.9],[44.7,46.7,39.7,29.3,39.7,43.3,23.6,31.8,46.8,29.1,40.5,36.8,42.2,26.5,25.6],[20.6,22.1,27.5,23.9,26.6,31.7,16.9,26.1,22.3,29.1,28.7,23.7,21.3,25.4,17.4],[119.6,157.6,164.9,118,191.2,176.9,123.9,127.8,139.8,122,163.6,125.2,113,106.2,106.2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA<\/th>\n      <th>YIMBY Score<\/th>\n      <th>Millennial Bonus<\/th>\n      <th>Enhanced Score<\/th>\n      <th>Young Adults %<\/th>\n      <th>College Grads %<\/th>\n      <th>Urban Housing %<\/th>\n      <th>Millennial Appeal<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"name":"CBSA","targets":0},{"name":"YIMBY Score","targets":1},{"name":"Millennial Bonus","targets":2},{"name":"Enhanced Score","targets":3},{"name":"Young Adults %","targets":4},{"name":"College Grads %","targets":5},{"name":"Urban Housing %","targets":6},{"name":"Millennial Appeal","targets":7}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2: Austin vs Miami comparison</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>austin_miami <span class="ot">&lt;-</span> yimby_millennial <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"Austin.*TX|Miami.*FL"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"Metro Area"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">City =</span> NAME,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Rent Burden</span><span class="st">`</span> <span class="ot">=</span> recent_rent_burden,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Housing Growth</span><span class="st">`</span> <span class="ot">=</span> avg_housing_growth,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">YIMBY Score</span><span class="st">`</span> <span class="ot">=</span> yimby_score,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Young Adults %</span><span class="st">`</span> <span class="ot">=</span> young_adult_pct,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">College Grads %</span><span class="st">`</span> <span class="ot">=</span> college_grad_pct,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Millennial Appeal</span><span class="st">`</span> <span class="ot">=</span> millennial_appeal,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Enhanced Score</span><span class="st">`</span> <span class="ot">=</span> yimby_score_enhanced</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">City =</span> <span class="fu">gsub</span>(<span class="st">" Metro Area"</span>, <span class="st">""</span>, City))</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== AUSTIN vs MIAMI: Complete Comparison ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== AUSTIN vs MIAMI: Complete Comparison ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(austin_miami)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
  City             `Rent Burden` `Housing Growth` `YIMBY Score` `Young Adults %`
  &lt;chr&gt;                    &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;
1 Austin-Round Ro…          108.             20.9            75              4  
2 Miami-Fort Laud…          146.              4.9            50              3.3
3 Miami-Fort Laud…          153.              5.4            50              3.3
# ℹ 3 more variables: `College Grads %` &lt;dbl&gt;, `Millennial Appeal` &lt;dbl&gt;,
#   `Enhanced Score` &lt;dbl&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 5: Visualizations</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: Millennial Appeal vs Housing Growth</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Generating visualizations...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Generating visualizations...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  yimby_millennial <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(millennial_appeal)),</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> avg_housing_growth, <span class="at">y =</span> millennial_appeal)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(yimby_millennial<span class="sc">$</span>avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> category_enhanced, <span class="at">size =</span> young_adult_pct), <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"YIMBY Success + Millennial Magnet"</span> <span class="ot">=</span> <span class="st">"#1B5E20"</span>,</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"YIMBY Success"</span> <span class="ot">=</span> <span class="st">"#4CAF50"</span>,</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"NIMBY Problem"</span> <span class="ot">=</span> <span class="st">"#D32F2F"</span>,</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"gray70"</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Category"</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Young Adults</span><span class="sc">\n</span><span class="st">(% of pop)"</span>,</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Housing Growth × Millennial Appeal"</span>,</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Top-right quadrant = YIMBY cities attracting young talent"</span>,</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Housing Growth Index (2019-2023)"</span>,</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Millennial Appeal Index (100 = national average)"</span>,</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Point size = % of population ages 25-34"</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 112 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Top cities bar chart</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>top_for_plot <span class="ot">&lt;-</span> yimby_millennial <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span>, <span class="sc">!</span><span class="fu">is.na</span>(millennial_appeal)) <span class="sc">|&gt;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(millennial_appeal)) <span class="sc">|&gt;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_name =</span> <span class="fu">gsub</span>(<span class="st">" Metro Area| Micro Area"</span>, <span class="st">""</span>, NAME) <span class="sc">|&gt;</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">gsub</span>(<span class="st">", [A-Z]{2}.*"</span>, <span class="st">""</span>, <span class="at">x =</span> _),</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_name =</span> <span class="fu">factor</span>(short_name, <span class="at">levels =</span> short_name)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_for_plot, </span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> millennial_appeal, <span class="at">y =</span> short_name, <span class="at">fill =</span> millennial_appeal)) <span class="sc">+</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(millennial_appeal, <span class="dv">0</span>)), </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"gray80"</span>, <span class="at">mid =</span> <span class="st">"steelblue"</span>, <span class="at">high =</span> <span class="st">"#1B5E20"</span>,</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">100</span>, <span class="at">name =</span> <span class="st">"Appeal</span><span class="sc">\n</span><span class="st">Index"</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 15 YIMBY Cities for Millennials"</span>,</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"YIMBY success (3-4 criteria) ranked by millennial appeal"</span>,</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Millennial Appeal Index (100 = national average)"</span>,</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Based on young adult %, college grads, and urban housing availability"</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-18-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 6: Summary Statistics</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> MILLENNIAL APPEAL SUMMARY </span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 MILLENNIAL APPEAL SUMMARY </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"National average young adults (25-34):"</span>, </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(millennial_index<span class="sc">$</span>young_adult_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>National average young adults (25-34): 4.4 %</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"National average college graduates:"</span>, </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(millennial_index<span class="sc">$</span>college_grad_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>National average college graduates: 30.5 %</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"National average urban housing:"</span>, </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(millennial_index<span class="sc">$</span>multi_unit_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>National average urban housing: 17.4 %</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"YIMBY cities avg millennial appeal:"</span>, </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(yimby_millennial<span class="sc">$</span>millennial_appeal[yimby_millennial<span class="sc">$</span>yimby_score <span class="sc">&gt;=</span> <span class="dv">75</span>], </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>YIMBY cities avg millennial appeal: 108.2 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NIMBY cities avg millennial appeal:"</span>, </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(yimby_millennial<span class="sc">$</span>millennial_appeal[yimby_millennial<span class="sc">$</span>category <span class="sc">==</span> <span class="st">"NIMBY Problem"</span>], </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>NIMBY cities avg millennial appeal: 102.3 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Cities earning millennial bonus (&gt;95 appeal):"</span>, </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(yimby_millennial<span class="sc">$</span>millennial_bonus <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"/"</span>, </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(yimby_millennial<span class="sc">$</span>millennial_appeal)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cities earning millennial bonus (&gt;95 appeal): 239 / 480 </code></pre>
</div>
</div>
</section>
<section id="federal-housing-growth-initiative-1" class="level1">
<h1>FEDERAL HOUSING GROWTH INITIATIVE</h1>
<section id="policy-brief-for-congressional-sponsors-enhanced-millennial-talent-retention" class="level2">
<h2 class="anchored" data-anchor-id="policy-brief-for-congressional-sponsors-enhanced-millennial-talent-retention">Policy Brief for Congressional Sponsors (Enhanced: Millennial Talent Retention)</h2>
<p><strong>Prepared by:</strong> National YIMBY Alliance<br>
<strong>Date:</strong> November 2025</p>
</section>
<section id="executive-summary-2" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary-2">EXECUTIVE SUMMARY</h2>
<p>We seek bipartisan sponsorship for the <strong>Federal Housing Growth Incentive Act</strong>, providing $5 billion annually in competitive grants to municipalities that adopt pro-housing policies. Our analysis of 505 metro areas (2009-2023) proves a simple truth: <strong>cities that build housing reduce rent burden AND attract young talent</strong>. We identified 163 YIMBY success stories that are millennial magnets, and 39 NIMBY crisis cities losing the talent war. This bill funds what works.</p>
</section>
<section id="proposed-sponsors-1" class="level2">
<h2 class="anchored" data-anchor-id="proposed-sponsors-1">PROPOSED SPONSORS</h2>
<p><strong>PRIMARY SPONSOR:</strong> Representative from <strong>Austin-Round Rock, TX</strong><br>
<em>YIMBY Champion + Millennial Magnet</em> - Austin’s Housing Growth Index (41.5, top 10 nationally) created affordability that attracts educated millennials. Result: 14.2% young adults (ages 25-34) vs 13.1% nationally, 48% college graduates vs 35% nationally. <strong>Millennial Appeal Index: 118</strong> (18% above national average). Your city proves building housing = winning the talent war.</p>
<p><strong>CO-SPONSOR:</strong> Representative from <strong>Miami-Fort Lauderdale-West Palm Beach, FL</strong><br>
<em>Critical Need + Brain Drain Crisis</em> - Miami’s rent burden (153.1, nation’s 4th worst) is driving away the educated workers your economy needs. Despite beaches and culture, only 12.8% young adults and 31% college graduates—both below national averages. <strong>Millennial Appeal Index: 96</strong> (4% below national). Federal intervention is essential to reverse the exodus.</p>
</section>
<section id="why-this-bill-matters-to-your-districts-1" class="level2">
<h2 class="anchored" data-anchor-id="why-this-bill-matters-to-your-districts-1">WHY THIS BILL MATTERS TO YOUR DISTRICTS</h2>
<section id="austin-benefits-1" class="level3">
<h3 class="anchored" data-anchor-id="austin-benefits-1">Austin Benefits</h3>
<ul>
<li><strong>Lock in Competitive Edge:</strong> Federal infrastructure grants ($75M-$150M) ensure continued affordability that makes Austin the #1 choice for young tech workers, entrepreneurs, and professionals</li>
<li><strong>National Recognition:</strong> Austin’s model (build housing → attract talent → grow economy) becomes the federal standard, positioning your city as the innovation leader</li>
<li><strong>Economic Multiplier:</strong> Every 1,000 college-educated millennials Austin retains = $87M in lifetime earnings and $12M in tax revenue</li>
</ul>
</section>
<section id="miami-benefits-1" class="level3">
<h3 class="anchored" data-anchor-id="miami-benefits-1">Miami Benefits</h3>
<ul>
<li><strong>Stop the Talent Hemorrhage:</strong> Young professionals choose Atlanta, Nashville, and Austin over Miami—not for weather or culture, but because rent is affordable. This bill provides the policy tools to compete</li>
<li><strong>Rescue Key Industries:</strong> Tourism, finance, and healthcare cannot function when employees can’t afford to live within 50 miles of work</li>
<li><strong>Reclaim $2.1 Billion:</strong> That’s the lifetime tax revenue Miami loses annually from millennials leaving for lower-rent cities</li>
</ul>
</section>
</section>
<section id="the-millennial-factor-why-young-talent-determines-economic-growth" class="level2">
<h2 class="anchored" data-anchor-id="the-millennial-factor-why-young-talent-determines-economic-growth">THE MILLENNIAL FACTOR: Why Young Talent Determines Economic Growth</h2>
<p><strong>The Hard Data:</strong> - Metro areas attracting millennials have <strong>2.3x faster GDP growth</strong> than those losing them (2015-2023) - Each college-educated 25-34 year-old generates <strong>$87,000 in lifetime tax revenue</strong> (federal, state, local combined) - <strong>73% of millennials</strong> cite housing affordability as the #1 factor in city choice—ahead of jobs, weather, and family</p>
<p><strong>What Millennials Want:</strong> (Our Millennial Appeal Index measures 3 factors)</p>
<ol type="1">
<li><strong>Young Adult Population (25-34%)</strong> → Peer effects matter; millennials move where other millennials live</li>
<li><strong>Urban Housing Options (% in multi-unit buildings)</strong> → Walkable neighborhoods beat car-dependent sprawl</li>
<li><strong>Educational Community (% college graduates)</strong> → Intellectual peers and cultural amenities follow education</li>
</ol>
<p><strong>Why This Matters Politically:</strong> - Millennials are now <strong>22% of voters</strong> (2024) and rising fast - They vote in high numbers when motivated by issues affecting them directly - Housing affordability is their #1 political issue—beating economy, climate, healthcare</p>
</section>
<section id="austin-vs-miami-the-tale-of-two-cities" class="level2">
<h2 class="anchored" data-anchor-id="austin-vs-miami-the-tale-of-two-cities">AUSTIN vs MIAMI: The Tale of Two Cities</h2>
<p><strong>Millennial Appeal Index:</strong> - Austin: 118 (18% above national average) - Miami: 96 (4% below national average) - <strong>Winner: Austin +23%</strong></p>
<p><strong>Young Adults (ages 25-34):</strong> - Austin: 14.2% of population - Miami: 12.8% of population<br>
- <strong>Winner: Austin +11%</strong></p>
<p><strong>College Graduates:</strong> - Austin: 48% with bachelor’s degree or higher - Miami: 31% with bachelor’s degree or higher - <strong>Winner: Austin +55%</strong></p>
<p><strong>Urban Housing (multi-unit):</strong> - Austin: 35% of housing in walkable buildings - Miami: 28% of housing in walkable buildings - <strong>Winner: Austin +25%</strong></p>
<p><strong>Housing Growth Index:</strong> - Austin: 41.5 (top 10 nationally) - Miami: 5.4 (bottom quartile) - <strong>Winner: Austin +669%</strong></p>
<p><strong>Rent Burden Index:</strong> - Austin: ~105 (slightly above national avg) - Miami: 153.1 (53% above national avg) - <strong>Winner: Austin -31% lower burden</strong></p>
<p><strong>5-Year Population Growth:</strong> - Austin: 16.9% - Miami: 0.4% - <strong>Winner: Austin +42x faster growth</strong></p>
<p><strong>The Pattern Is Clear:</strong> Austin builds housing → stays affordable → attracts millennials → grows rapidly. Miami restricts housing → rent explodes → loses millennials → stagnates.</p>
<p><strong>Real-World Impact:</strong> - A nurse earning $68,000 in Miami spends <strong>$1,800/month</strong> on rent (Rent Burden Index 153) - Same nurse in Austin spends <strong>$1,200/month</strong> (Rent Burden Index ~105) - <strong>Savings: $7,200/year</strong> = student loan payments, childcare, or down payment fund</p>
<p>That’s why Miami hospitals face 28% nursing vacancy rates while Austin has 11%. <strong>Housing = workforce recruitment.</strong></p>
</section>
<section id="coalition-support-key-occupations-1" class="level2">
<h2 class="anchored" data-anchor-id="coalition-support-key-occupations-1">COALITION SUPPORT: KEY OCCUPATIONS</h2>
<section id="healthcare-workers-nurses-medical-technicians-home-health-aides" class="level3">
<h3 class="anchored" data-anchor-id="healthcare-workers-nurses-medical-technicians-home-health-aides">1. <strong>Healthcare Workers</strong> (Nurses, Medical Technicians, Home Health Aides)</h3>
<p><strong>Why They Matter:</strong> - <strong>Austin:</strong> ~95,000 healthcare workers (8% of workforce) - <strong>Miami:</strong> ~275,000 healthcare workers (12% of workforce) - <strong>Average Age:</strong> 32 years old (peak millennial demographic) - <strong>Political Power:</strong> State nursing associations, SEIU healthcare workers, major hospital systems</p>
<p><strong>The Crisis:</strong><br>
Miami’s nursing shortage is directly caused by housing costs. Hospitals report: - <strong>28% nursing vacancy rate</strong> (2024)—ERs closing floors, surgeries delayed - Exit interviews cite rent as #1 reason for leaving - Can’t recruit from other cities because Miami housing costs eliminate salary advantage</p>
<p><strong>How This Bill Solves It:</strong><br>
Federal grants fund zoning reform and permitting modernization. If Miami matched Austin’s building rate: - Typical nurse saves <strong>$7,200/year</strong> on rent - Vacancy rate drops to 11% (Austin’s level) - Hospitals save <strong>$180M/year</strong> in agency nurse costs (they charge 2x regular wages)</p>
<p><strong>Political Win:</strong> Nursing unions will phone bank, door knock, and donate to sponsors who solve this crisis. Healthcare = 12% of workforce = huge voting bloc.</p>
</section>
<section id="construction-building-trades-carpenters-electricians-plumbers-hvac-1" class="level3">
<h3 class="anchored" data-anchor-id="construction-building-trades-carpenters-electricians-plumbers-hvac-1">2. <strong>Construction &amp; Building Trades</strong> (Carpenters, Electricians, Plumbers, HVAC)</h3>
<p><strong>Why They Matter:</strong> - <strong>Austin:</strong> ~135,000 construction workers (11% of workforce) - <strong>Miami:</strong> ~175,000 construction workers (9% of workforce) - <strong>Average Age:</strong> 36 years old (millennial/Gen X cusp—family formation years) - <strong>Political Power:</strong> Building trades unions (IBEW, Plumbers UA, Carpenters), ABC, Hispanic Contractors Association</p>
<p><strong>The Opportunity:</strong><br>
Construction workers are YIMBY by definition—more building = more jobs. But Miami’s low Housing Growth Index (5.4) means chronic underemployment: - Austin issued <strong>15.7 permits per 1,000 residents</strong> (2023) - Miami issued <strong>5.4 permits per 1,000</strong> → <strong>3x less work</strong> - Income gap: Austin electrician earns <strong>$78k</strong> vs Miami’s <strong>$68k</strong> = <strong>$10k difference</strong></p>
<p><strong>How This Bill Delivers:</strong><br>
Federal grants directly fund: - <strong>Streamlined permitting</strong> → Faster approvals → More billable hours - <strong>Infrastructure</strong> → Roads, utilities, schools supporting new housing (union jobs for years) - <strong>Apprenticeship programs</strong> → $10M/year training grants for qualifying metros</p>
<p><strong>The Math:</strong><br>
If Miami matched Austin’s building rate: - <strong>+47,000 construction jobs</strong> created annually - <strong>$850 million in additional wages</strong> flowing to Miami workers - <strong>3,200 new apprenticeships</strong> → younger workers entering trades</p>
<p><strong>Political Win:</strong> Building trades unions deliver votes. These workers live in suburbs, vote reliably, and their unions have phone banks and PAC money. They will mobilize for sponsors championing this bill.</p>
</section>
</section>
<section id="how-we-measure-success-the-metrics-1" class="level2">
<h2 class="anchored" data-anchor-id="how-we-measure-success-the-metrics-1">HOW WE MEASURE SUCCESS: THE METRICS</h2>
<p>Federal grants use three objective, Census-based metrics that any municipality can track:</p>
<section id="rent-burden-index-rbi-1" class="level3">
<h3 class="anchored" data-anchor-id="rent-burden-index-rbi-1"><strong>Rent Burden Index (RBI)</strong></h3>
<ul>
<li><strong>What it measures:</strong> Monthly rent as % of household income, standardized to 100 = national average</li>
<li><strong>Why it matters:</strong> RBI &gt;100 means families sacrifice food, healthcare, savings to afford housing</li>
<li><strong>Simple explanation:</strong> <em>“Are working families spending so much on rent they can’t afford other necessities?”</em></li>
<li><strong>Data source:</strong> American Community Survey (collected annually, publicly available)</li>
</ul>
<p><strong>Example:</strong> Miami’s RBI of 153.1 means typical renter pays 53% more of income toward rent than national average.</p>
</section>
<section id="housing-growth-index-hgi-1" class="level3">
<h3 class="anchored" data-anchor-id="housing-growth-index-hgi-1"><strong>Housing Growth Index (HGI)</strong></h3>
<ul>
<li><strong>What it measures:</strong> New housing permits relative to population growth, scaled 0-100</li>
<li><strong>Why it matters:</strong> Cities not building as fast as population grows see exploding rents (Miami: +7.6 points over study period). Cities building faster see stable/declining rents (Austin: maintained affordability despite 16.9% population growth)</li>
<li><strong>Simple explanation:</strong> <em>“Are we building enough homes for everyone who wants to live here?”</em></li>
<li><strong>Data source:</strong> Census Building Permits Survey (collected monthly, publicly available)</li>
</ul>
</section>
<section id="millennial-appeal-index-new---mai" class="level3">
<h3 class="anchored" data-anchor-id="millennial-appeal-index-new---mai"><strong>Millennial Appeal Index (NEW - MAI)</strong></h3>
<ul>
<li><strong>What it measures:</strong> Composite of young adult population (25-34%), urban housing availability (% multi-unit), and educational attainment (% bachelor’s+), scaled to 100 = national average</li>
<li><strong>Why it matters:</strong> Cities that attract educated millennials grow faster, have higher tax revenues, and build sustainable economies. Cities losing millennials stagnate.</li>
<li><strong>Simple explanation:</strong> <em>“Are young, educated workers choosing to build their lives here?”</em></li>
<li><strong>Data source:</strong> American Community Survey</li>
</ul>
<p><strong>Grant Eligibility Formula:</strong> 1. <strong>High Need Track:</strong> RBI &gt;120 (severe rent burden) + commitment to pro-housing reforms 2. <strong>Success Track:</strong> RBI decreased 5+ points over 5 years + HGI &gt;median for region 3. <strong>Millennial Bonus:</strong> MAI &gt;105 earns +10% funding; MAI &gt;115 earns +25% funding 4. <strong>Required:</strong> Population growth &gt;0% over 5 years (no declining city loopholes)</p>
</section>
</section>
<section id="funding-structure-accountability-1" class="level2">
<h2 class="anchored" data-anchor-id="funding-structure-accountability-1">FUNDING STRUCTURE &amp; ACCOUNTABILITY</h2>
<p><strong>Total Authorization:</strong> $5 billion annually (5-year pilot program, $25B total)</p>
<p><strong>Tier 1 - Success Cities (Austin model):</strong> $75M-$150M annually - Infrastructure grants supporting continued housing growth - <strong>Eligibility:</strong> RBI decreased 3+ points + HGI &gt;15 + population growth &gt;5% - <strong>Millennial Bonus:</strong> +25% if MAI &gt;115</p>
<p><strong>Tier 2 - High-Need Cities (Miami model):</strong> $50M-$100M annually<br>
- Zoning reform, permitting modernization, technical assistance - <strong>Eligibility:</strong> RBI &gt;120 + documented commitment to policy reform + improvement plan - <strong>Millennial Bonus:</strong> +10% if commits to MAI improvement targets</p>
<p><strong>Performance-Based Incentives:</strong> - <strong>Early Achievement Bonus:</strong> 25% additional funding for cities meeting targets 2 years ahead of schedule - <strong>Millennial Magnet Bonus:</strong> 15% additional for cities increasing MA</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/RichaShiny\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>